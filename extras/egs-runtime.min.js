!function(a){"use strict";var b=function(a){function b(c){var d=Object.prototype.hasOwnProperty;if(d.call(b._cache,c))return b._cache[c];if(d.call(b,c)){var e=b[c];return delete b[c],b._cache[c]=e.call({})}return a?a(c):void 0}return b._cache={},b["./runtime"]=function(){var a={exports:this};return function(c){function d(a){var b;return b=/^[^\.]+(\..*)$/.exec(E.basename(a)),b?b[1]:""}function e(a){return function(){return a}}function f(a){var b,c,d;c=a.maybeSync;for(b in a)p.call(a,b)&&(d=a[b],c[b]=d);return c}function g(a,b){return b&&a?(a(b),""):b}function h(a,b,c){var d,e;return null==c&&(c=!1),e=q(function(e){function f(){j=10}function g(f){for(;;)switch(j){case 0:m=c&&d,j=m?3:1;break;case 1:return++j,{done:!1,value:a()};case 2:m=f,c&&(d=m),++j;case 3:k=b(m.isSimple),l=m.func("",e||{},k),j=l&&l.then?4:6;break;case 4:return++j,{done:!1,value:l};case 5:l=f,++j;case 6:j=k.__extendedBy$?7:9;break;case 7:return++j,{done:!1,value:k.__handleExtends$.maybeSync.call(k,l)};case 8:return j=10,{done:!0,value:f};case 9:return++j,{done:!0,value:l};case 10:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l,m;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e.sync=function(e){var f,g,h,i;return i=c&&d,i||(i=a().sync(),c&&(d=i)),g=b(i.isSimple),f=i.func,h=(f.sync||f)("",e||{},g),"string"!=typeof h&&(h=h.sync()),g.__extendedBy$?g.__handleExtends$.sync.call(g,h):h},e.stream=function(e){var f,g,h,j,l,n;return f=i(),l=f.send,h=f.end,n=f["throw"],j=f["public"],g=m(function(){function f(){j=11}function g(f){for(;;)switch(j){case 0:q=c&&d,j=q?3:1;break;case 1:return++j,{done:!1,value:a()};case 2:q=f,c&&(d=q),++j;case 3:return o=b(q.isSimple),o.__streamSend$=l,++j,{done:!1,value:k.fulfilled()};case 4:n=q.func,p=n.stream?n.stream(l,"",e||{},o):n("",e||{},o),j=p&&p.then?5:7;break;case 5:return++j,{done:!1,value:p};case 6:p=f,++j;case 7:j=o.__extendedBy$?8:10;break;case 8:return m=o.__handleExtends$,++j,{done:!1,value:m.call(o,p)};case 9:return j=11,{done:!0,value:f};case 10:return++j,{done:!0,value:p};case 11:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,m,n,o,p,q;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}()),g.then(function(a){a&&l(a),h()}).then(null,n),j},e.ready=q(function(){function f(){j=6}function g(f){for(;;)switch(j){case 0:j=c?1:5;break;case 1:j=d?4:2;break;case 2:return++j,{done:!1,value:a()};case 3:d=f,++j;case 4:k=d.func,k.sync&&(k=k.sync),d.isSimple&&(l=b(!0),e.sync=function(a){var b;return b=k("",a||{},l),"string"!=typeof b?b.sync():b}),j=6;break;case 5:return++j,{done:!1,value:a()};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e}function i(){function a(a,c){var d;b&&(d=b[a],b=null,d&&F(d,c))}var b;return b={},{send:function(a){var c;b&&(c=b.data,c&&c(a))},"throw":function(b){a("error",b)},end:function(){a("end")},"public":{on:function(a,c){return b&&(b[a]=c),this}}}}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;v=this,j="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},k=function(){function a(){function b(a,b){var f;c&&(f=c,c=null,d=a,e=b,f.length&&F(function(){var a,b;for(b=0,a=f.length;a>b;++b)f[b]()}))}var c,d,e;return d=!1,e=null,c=[],{promise:{then:function(b,f,g){function h(){var a,c;try{a=d?f:b,"function"==typeof a?(c=a(e),c&&"function"==typeof c.then?c.then(j,l,g):j(c)):(d?l:j)(e)}catch(h){l(h)}}var i,j,k,l;return g!==!0&&(g=void 0),i=a(),k=i.promise,j=i.fulfill,l=i.reject,c?c.push(h):g?h():F(h),k},sync:function(){var a,b;switch(b=0,a=0,this.then(function(c){return b=1,a=c},function(c){return b=2,a=c},!0),b){case 0:throw Error("Promise did not execute synchronously");case 1:return a;case 2:throw a;default:throw Error("Unknown state")}}},fulfill:function(a){b(!1,a)},reject:function(a){b(!0,a)}}}return a.fulfilled=function(b){var c;return c=a(),c.fulfill(b),c.promise},a.rejected=function(b){var c;return c=a(),c.reject(b),c.promise},a}(),l=function(a){if("object"!=typeof a||null===a)throw TypeError("Expected promise to be an Object, got "+t(a));if("function"!=typeof a.then)throw TypeError("Expected promise.then to be a Function, got "+t(a.then));return function(b){a.then(function(a){return F(b,null,a)},function(a){return F(b,a)})}},m=function(a,b){function c(c,f){var g;try{g=a[c](f)}catch(h){return k.rejected(h)}return g.done?k.fulfilled(g.value):g.value.then(d,e,b)}function d(a){return c("send",a)}function e(a){return c("throw",a)}if("object"!=typeof a||null===a)throw TypeError("Expected generator to be an Object, got "+t(a));if("function"!=typeof a.send)throw TypeError("Expected generator.send to be a Function, got "+t(a.send));if("function"!=typeof a["throw"])throw TypeError("Expected generator.throw to be a Function, got "+t(a["throw"]));if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+t(b));return d(void 0)},n=function(a,b){var c;for(c in b)p.call(b,c)&&(a[c]=b[c]);return a},o="function"==typeof Array.isArray?Array.isArray:function(){var a;return a=Object.prototype.toString,function(b){return"[object Array]"===a.call(b)}}(),p=Object.prototype.hasOwnProperty,q=function(a,b){var c;if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+t(b));return"function"==typeof a?(c=function(){return m(a.apply(this,arguments))},c.sync=function(){return m(a.apply(this,arguments),!0).sync()},c.maybeSync=function(){return m(a.apply(this,arguments),!0)},c):m(a,b)},r=Array.prototype.slice,s=function(a){if(null==a)throw TypeError("Expected an object, got "+t(a));if(o(a))return a;if("string"==typeof a)return a.split("");if("number"==typeof a.length)return r.call(a);throw TypeError("Expected an object with a length property, got "+t(a))},t=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),F="function"==typeof c.setImmediate?c.setImmediate:"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){var a;return a=process.nextTick,function(b){var c;if("function"!=typeof b)throw TypeError("Expected func to be a Function, got "+t(b));return c=r.call(arguments,1),c.length?a(function(){b.apply(void 0,s(c))}):a(b)}}():function(a){var b;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+t(a));return b=r.call(arguments,1),b.length?setTimeout(function(){a.apply(void 0,s(b))},0):setTimeout(a,0)},y=b("fs"),E=b("path"),A=b("./helpers"),w=function(a){function b(d){var e,f;return e=this instanceof b?this:j(c),null==d&&(d=""),e.message=d,f=a.call(e,d),"function"==typeof a.captureStackTrace?a.captureStackTrace(e,b):"stack"in f&&(e.stack=f.stack),e}var c,d;return d=a.prototype,c=b.prototype=j(d),c.constructor=b,b.displayName="EGSError","function"==typeof a.extended&&a.extended(b),c.name="EGSError",b}(Error),z=function(){var a;return a={},function(b,c){var e,f;return f=p.call(a,c)?a[c]:a[c]={},p.call(f,b)?f[b]:(e=b,E.extname(e)||(e+=""+d(c)),f[b]=E.resolve(E.dirname(c),e))}}(),G=n({},A),u=n({},A),u["extends"]=function(a,b){if(!this.__currentFilepath$)throw w("Can only use extends if the 'filename' option is specified");if(this.__inPartial$)throw w("Cannot use extends when in a partial");if(this.__extendedBy$)throw w("Cannot use extends more than once");this.__extendedBy$=this.__fetchCompiled$(a),this.__extendedByLocals$=b},u.partial=f(q(function(a,b,c){function d(){l=5}function e(d){for(;;)switch(l){case 0:if(null==c&&(c={}),!m.__currentFilepath$)throw w("Can only use partial if the 'filename' option is specified");return a=E.join(E.dirname(a),""+m.__partialPrefix$+E.basename(a)),b=g(m.__streamSend$,b),++l,{done:!1,value:m.__fetchCompiled$(a)};case 1:k=d,n=k.filepath,o=k.compiled.func,i=j(m),i.__currentFilepath$=n,i.__inPartial$=!0,p=i,l=o.maybeSync?2:4;break;case 2:return++l,{done:!1,value:o.maybeSync(b,c,p)};case 3:return l=5,{done:!0,value:d};case 4:return++l,{done:!0,value:o(b,c,p)};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+l)}}function f(a){throw d(),a}function h(a){try{return e(a)}catch(b){f(b)}}var i,k,h,l,e,m,f,n,o,p;return m=this,l=0,{close:d,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return f(a),h(void 0)}}})),u.block=f(q(function(a,b,c){function d(){i=6}function e(d){for(;;)switch(i){case 0:if(null==c&&(c=null),j.__inPartial$)throw w("Cannot use block when in a partial");b=g(j.__streamSend$,b),l=j.__blocks$,n=j.__helpers$,i=j.__extendedBy$&&!n.__inBlock$?1:2;break;case 1:return null==c||p.call(l,a)||(l[a]=c),i=6,{done:!0,value:b};case 2:k=p.call(l,a)&&l[a]||c,m=b,i=k?3:5;break;case 3:return n.__inBlock$=!0,++i,{done:!1,value:q(k(b),!0)};case 4:m=d,n.__inBlock$=!1,++i;case 5:return++i,{done:!0,value:m};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function f(a){throw d(),a}function h(a){try{return e(a)}catch(b){f(b)}}var h,i,e,j,f,k,l,m,n;return j=this,i=0,{close:d,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return f(a),h(void 0)}}})),u.__handleExtends$=f(q(function(){function a(){g=9}function b(a){for(;;)switch(g){case 0:return++g,{done:!1,value:h.__extendedBy$};case 1:f=a,i=f.filepath,k=f.compiled.func,e=j(h),e.__currentFilepath$=i,e.__extendedBy$=null,e.__extendedByLocals$=null,m=e,l=h.__extendedByLocals$||{},g=k.maybeSync?2:4;break;case 2:return++g,{done:!1,value:k.maybeSync("",l,m)};case 3:n=a,g=5;break;case 4:n=k("",l,m),++g;case 5:g=m.__extendedBy$?6:8;break;case 6:return++g,{done:!1,value:m.__handleExtends$.call(m,n)};case 7:return g=9,{done:!0,value:a};case 8:return++g,{done:!0,value:n};case 9:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function c(b){throw a(),b}function d(a){try{return b(a)}catch(d){c(d)}}var e,f,d,g,b,h,c,i,k,l,m,n;return h=this,g=0,{close:a,iterator:function(){return this},next:function(){return d(void 0)},send:d,"throw":function(a){return c(a),d(void 0)}}})),B=u,x=function(){function a(a){return c.test(a)?a.replace(b,"&amp;").replace(e,"&lt;").replace(d,"&gt;").replace(f,"&quot;"):a}var b,c,d,e,f;return c=/[&<>"]/,b=/&/g,e=/</g,d=/>/g,f=/"/g,function(b){if("string"==typeof b)return a(b);if("number"==typeof b)return b.toString();if(b&&"function"==typeof b.toHTML)return String(b.toHTML());throw TypeError("Expected a String, Number, or Object with a toHTML method, got "+t(b))}}(),C=function(){function a(a,b,c,d,e){var f,g;return f=j(B),f.__currentFilepath$=b,f.__partialPrefix$=a,f.__fetchCompiled$=c,f.__extendedBy$=null,f.__extendedByLocals$=null,f.__inPartial$=!1,f.__inBlock$=!1,f.escape=d,g=j(G),g.__currentFilepath$=b,g.escape=d,e&&(n(g,e),n(f,e)),function(a){var b;return a?g:(b=j(f),b.__helpers$=b,b.__blocks$={},b)}}return function(b,c){return a("string"==typeof b.partialPrefix?b.partialPrefix:"_",b.filename,function(a){return c(a,this.__currentFilepath$)},"function"==typeof b.escape?b.escape:x,p.call(b,"context")?b.context:b)}}(),D=function(){function a(b,c){var e;if(e=this instanceof a?this:j(d),b&&"object"==typeof b&&null!==b)return a.call(e,null,b);if(b&&"0.2.1"!==b)throw Error("EGS Packages must be compiled with the same version as the EGS runtime: '"+b+"' vs. '0.2.1'");return e.factories={},e.templates={},e.options=null!=c?c:{},e}function b(a){return 47!==a.charCodeAt(0)?"/"+a:a}function c(a,b,c){var d;return d=z(b,c),p.call(a,d)?k.fulfilled({filepath:d,compiled:{func:a[d],isSimple:!1}}):k.rejected(w("Cannot find '"+b+"' from '"+d+"', tried '"+d+"'"))}var d;return d=a.prototype,a.displayName="Package",d.set=function(a,d,f){var g,i;return null==f&&(f={}),a=b(a),g=this.factories,i=g[a]=q(d),this.templates[a]=h(e(k.fulfilled({func:i,isSimple:!1})),C(n(n({__inPackage$:this,filename:a},this.options),f),function(a,b){return c(g,a,b)}),!0),this},d.get=function(a){var c;if(a=b(a),c=this.templates,p.call(c,a))return c[a];throw w("Unknown filepath: '"+a+"'")},d.render=q(function(a,b){function c(){g=2}function d(c){for(;;)switch(g){case 0:return null==b&&(b={}),i=h.get(a),++g,{done:!1,value:i(b)};case 1:return++g,{done:!0,value:c};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,h,e,i;return h=this,g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),d.renderSync=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.sync(b)},d.renderStream=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.stream(b)},d.express=function(){var a;return a=this,function(b,c,d){l(a.render(b,c))(d)}},a}(),a.exports={version:"0.2.1",Package:D,EGSError:w,makeTemplate:h,makeHelpersFactory:C,guessFilepath:z,helperNames:function(){var a,b;a=[];for(b in A)p.call(A,b)&&a.push(b);return a}()}}.call(this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),a.exports},b["./helpers"]=function(){var a={exports:this},b=this;return function(){var a,c,d,e;a="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},c="function"==typeof Array.isArray?Array.isArray:function(){var a;return a=Object.prototype.toString,function(b){return"[object Array]"===a.call(b)}}(),d=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),e=function(){function b(d){var e;return e=this instanceof b?this:a(c),e.text=d,e}var c;return c=b.prototype,b.displayName="RawHTML",c.toHTML=function(){return this.text},b}(),b.h=b.html=function(a){return e(String(a))},b.j=b.javascript=function(){function a(a){return b[a]}var b,c;return b={"\\":"\\\\","\r":"\\r","\u2028":"\\u2028","\u2029":"\\u2029","\n":"\\n","\f":"\\f","'":"\\'",'"':'\\"',"	":"\\t"},c=/[\\\r\u2028\u2029\n\f'"\t]/g,function(b){return e(String(b).replace(c,a))}}(),b.__maybeEscape=function(a,b){if("function"!=typeof a)throw TypeError("Expected escape to be a Function, got "+d(a));if(!c(b))throw TypeError("Expected arr to be an Array, got "+d(b));return b[1]?a(b[0]):b[0]}}.call(this),a.exports},b("./runtime")};"function"==typeof define&&define.amd?define(function(a){return b(a)}):"undefined"!=typeof module&&"function"==typeof require?module.exports=b(require):a.EGSRuntime=b()}(this);