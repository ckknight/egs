!function(a){"use strict";var b=function(){var a={},b={exports:a};return function(a){function c(a){var b;return b=/.*?[\/\\](.*)/.exec(a),b?b[1]:a}function d(a){var b;return b=/(.*)[\/\\]/.exec(a),b?b[1]:"."}function e(a,b){return"."===a?b:a+"/"+b}function f(a){var b;return b=/^[^\.]+(\..*)$/.exec(c(a)),b?b[1]:""}function g(a){return/.\./.test(c(a))}function h(a,b){return/^[\/\\]/.test(b)?b:/^..[\/\\]/.test(b)?h(d(a),b.substring(3)):e(a,b)}function i(a){return function(){return a}}function j(a){var b,c,d;c=a.maybeSync;for(b in a)t.call(a,b)&&(d=a[b],c[b]=d);return c}function k(a,b){return b&&a?(a(b),""):b}function l(a,b,c){var d,e;return null==c&&(c=!1),e=u(function(e){function f(){j=10}function g(f){for(;;)switch(j){case 0:m=c&&d,j=m?3:1;break;case 1:return++j,{done:!1,value:a()};case 2:m=f,c&&(d=m),++j;case 3:k=b(m.isSimple),l=m.func("",e||{},k),j=l&&l.then?4:6;break;case 4:return++j,{done:!1,value:l};case 5:l=f,++j;case 6:j=k.__extendedBy$?7:9;break;case 7:return++j,{done:!1,value:k.__handleExtends$.maybeSync.call(k,l)};case 8:return j=10,{done:!0,value:f};case 9:return++j,{done:!0,value:l};case 10:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l,m;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e.sync=function(e){var f,g,h,i;return i=c&&d,i||(i=a().sync(),c&&(d=i)),g=b(i.isSimple),f=i.func,h=(f.sync||f)("",e||{},g),"string"!=typeof h&&(h=h.sync()),g.__extendedBy$?g.__handleExtends$.sync.call(g,h):h},e.stream=function(e){var f,g,h,i,j,k;return f=m(),j=f.send,h=f.end,k=f["throw"],i=f["public"],f=null,g=q(function(){function f(){k=11}function g(f){for(;;)switch(k){case 0:q=c&&d,k=q?3:1;break;case 1:return++k,{done:!1,value:a()};case 2:q=f,c&&(d=q),++k;case 3:return n=b(q.isSimple),n.__streamSend$=j,++k,{done:!1,value:o.fulfilled()};case 4:m=q.func,p=m.stream?m.stream(j,"",e||{},n):m("",e||{},n),k=p&&p.then?5:7;break;case 5:return++k,{done:!1,value:p};case 6:p=f,++k;case 7:k=n.__extendedBy$?8:10;break;case 8:return l=n.__handleExtends$,++k,{done:!1,value:l.call(n,p)};case 9:return k=11,{done:!0,value:f};case 10:return++k,{done:!0,value:p};case 11:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+k)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,k,g,h,l,m,n,p,q;return k=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}()),g.then(function(a){a&&j(a),h()}).then(null,k),i},e.ready=u(function(){function f(){j=6}function g(f){for(;;)switch(j){case 0:j=c?1:5;break;case 1:j=d?4:2;break;case 2:return++j,{done:!1,value:a()};case 3:d=f,++j;case 4:k=d.func,k.sync&&(k=k.sync),d.isSimple&&(l=b(!0),e.sync=function(a){var b;return b=k("",a||{},l),"string"!=typeof b?b.sync():b}),j=6;break;case 5:return++j,{done:!1,value:a()};case 6:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e}function m(){function a(a,c){var d;b&&(d=b[a],b=null,d&&H(d,c))}var b;return b={},{send:function(a){var c;b&&(c=b.data,c&&c(a))},"throw":function(b){a("error",b)},end:function(){a("end")},"public":{on:function(a,c){return b&&(b[a]=c),this}}}}var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;z=this,n="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},o=function(){function a(){function b(a,b){var f;c&&(f=c,c=null,d=a,e=b,f.length&&H(function(){var a,b;for(b=0,a=f.length;a>b;++b)f[b]()}))}var c,d,e;return d=!1,e=null,c=[],{promise:{then:function(b,f,g){function h(){var a,c;try{a=d?f:b,"function"==typeof a?(c=a(e),c&&"function"==typeof c.then?c.then(j,l,g):j(c)):(d?l:j)(e)}catch(h){l(h)}}var i,j,k,l;return g!==!0&&(g=void 0),i=a(),k=i.promise,j=i.fulfill,l=i.reject,i=null,c?c.push(h):g?h():H(h),k},sync:function(){var a,b;switch(b=0,a=0,this.then(function(c){b=1,a=c},function(c){b=2,a=c},!0),b){case 0:throw new Error("Promise did not execute synchronously");case 1:return a;case 2:throw a;default:throw new Error("Unknown state")}}},fulfill:function(a){b(!1,a)},reject:function(a){b(!0,a)}}}return a.fulfilled=function(b){var c;return c=a(),c.fulfill(b),c.promise},a.rejected=function(b){var c;return c=a(),c.reject(b),c.promise},a}(),p=function(a){if("object"!=typeof a||null===a)throw new TypeError("Expected promise to be an Object, got "+x(a));if("function"!=typeof a.then)throw new TypeError("Expected promise.then to be a Function, got "+x(a.then));return function(b){if("function"!=typeof b)throw new TypeError("Expected callback to be a Function, got "+x(b));a.then(function(a){return H(b,null,a)},function(a){return H(b,a)})}},q=function(a,b){function c(c,f){var g;try{g=a[c](f)}catch(h){return o.rejected(h)}return g.done?o.fulfilled(g.value):g.value.then(d,e,b)}function d(a){return c("send",a)}function e(a){return c("throw",a)}if("object"!=typeof a||null===a)throw new TypeError("Expected generator to be an Object, got "+x(a));if("function"!=typeof a.send)throw new TypeError("Expected generator.send to be a Function, got "+x(a.send));if("function"!=typeof a["throw"])throw new TypeError("Expected generator.throw to be a Function, got "+x(a["throw"]));if(null==b)b=!1;else if("boolean"!=typeof b)throw new TypeError("Expected allowSync to be a Boolean, got "+x(b));return d(void 0)},r=function(a,b){var c;for(c in b)t.call(b,c)&&(a[c]=b[c]);return a},s="function"==typeof Array.isArray?Array.isArray:function(a){return function(b){return"[object Array]"===a.call(b)}}(Object.prototype.toString),t=Object.prototype.hasOwnProperty,u=function(a,b){var c;if(null==b)b=!1;else if("boolean"!=typeof b)throw new TypeError("Expected allowSync to be a Boolean, got "+x(b));return"function"==typeof a?(c=function(){return q(a.apply(this,arguments))},c.sync=function(){return q(a.apply(this,arguments),!0).sync()},c.maybeSync=function(){return q(a.apply(this,arguments),!0)},c):q(a,b)},v=Array.prototype.slice,w=function(a){if(null==a)throw new TypeError("Expected an object, got "+x(a));if(s(a))return a;if("string"==typeof a)return a.split("");if("number"==typeof a.length)return v.call(a);throw new TypeError("Expected an object with a length property, got "+x(a))},x=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),H="function"==typeof a.setImmediate?a.setImmediate:"undefined"!=typeof process&&"function"==typeof process.nextTick?function(a){return function(b){var c;if("function"!=typeof b)throw new TypeError("Expected func to be a Function, got "+x(b));return c=v.call(arguments,1),c.length?a(function(){b.apply(void 0,w(c))}):a(b)}}(process.nextTick):function(a){var b;if("function"!=typeof a)throw new TypeError("Expected func to be a Function, got "+x(a));return b=v.call(arguments,1),b.length?setTimeout(function(){a.apply(void 0,b)},0):setTimeout(a,0)},D=function(){var a,b;return a={},b=function(){function a(c){var d;return d=this instanceof a?this:n(b),d.text=c,d}var b;return b=a.prototype,a.displayName="RawHTML",b.toHTML=function(){return this.text},a}(),a.h=a.html=function(a){return b(String(a))},a.j=a.javascript=function(){function a(a){return c[a]}var c,d;return c={"\\":"\\\\","\r":"\\r","\u2028":"\\u2028","\u2029":"\\u2029","\n":"\\n","\f":"\\f","'":"\\'",'"':'\\"',"	":"\\t"},d=/[\\\r\u2028\u2029\n\f'"\t]/g,function(c){return b(String(c).replace(d,a))}}(),a.__maybeEscape=function(a,b){return b[1]?a(b[0]):b[0]},a}(),A=function(a){function b(d){var e,f;return e=this instanceof b?this:n(c),null==d&&(d=""),e.message=d,f=a.call(e,d),"function"==typeof a.captureStackTrace?a.captureStackTrace(e,b):"stack"in f&&(e.stack=f.stack),e}var c,d;return d=a.prototype,c=b.prototype=n(d),c.constructor=b,b.displayName="EGSError","function"==typeof a.extended&&a.extended(b),c.name="EGSError",b}(Error),C=function(){var a;return a={},function(b,c){var e,i;return i=b+"\0"+c,a[i]||(e=b,!g(e)&&(e+=""+f(c)),a[i]=h(d(c),e))}}(),I=r({},D),y=r({},D),y["extends"]=function(a,b){if(!this.__currentFilepath$)throw A("Can only use extends if the 'filename' option is specified");if(this.__inPartial$)throw A("Cannot use extends when in a partial");if(this.__extendedBy$)throw A("Cannot use extends more than once");this.__extendedBy$=this.__fetchCompiled$(a),this.__extendedByLocals$=b},y.partial=j(u(function(a,b,f){function g(){o=5}function h(g){for(;;)switch(o){case 0:if(null==f&&(f={}),!p.__currentFilepath$)throw A("Can only use partial if the 'filename' option is specified");return a=e(d(a),""+p.__partialPrefix$+c(a)),b=k(p.__streamSend$,b),++o,{done:!1,value:p.__fetchCompiled$(a)};case 1:m=g,q=m.filepath,r=m.compiled.func,m=null,l=n(p),l.__currentFilepath$=q,l.__inPartial$=!0,s=l,o=r.maybeSync?2:4;break;case 2:return++o,{done:!1,value:r.maybeSync(b,f,s)};case 3:return o=5,{done:!0,value:g};case 4:return++o,{done:!0,value:r(b,f,s)};case 5:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+o)}}function i(a){throw g(),a}function j(a){try{return h(a)}catch(b){i(b)}}var l,m,j,o,h,p,i,q,r,s;return p=this,o=0,{close:g,iterator:function(){return this},next:function(){return j(void 0)},send:j,"throw":function(a){return i(a),j(void 0)}}})),y.block=j(u(function(a,b,c){function d(){h=6}function e(d){for(;;)switch(h){case 0:if(null==c&&(c=null),i.__inPartial$)throw A("Cannot use block when in a partial");b=k(i.__streamSend$,b),l=i.__blocks$,n=i.__helpers$,h=i.__extendedBy$&&!n.__inBlock$?1:2;break;case 1:return null==c||t.call(l,a)||(l[a]=c),h=6,{done:!0,value:b};case 2:j=t.call(l,a)&&l[a]||c,m=b,h=j?3:5;break;case 3:return n.__inBlock$=!0,++h,{done:!1,value:u(j(b),!0)};case 4:m=d,n.__inBlock$=!1,++h;case 5:return++h,{done:!0,value:m};case 6:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,i,f,j,l,m,n;return i=this,h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}})),y.__handleExtends$=j(u(function(){function a(){g=9}function b(a){for(;;)switch(g){case 0:return++g,{done:!1,value:h.__extendedBy$};case 1:f=a,i=f.filepath,j=f.compiled.func,f=null,e=n(h),e.__currentFilepath$=i,e.__extendedBy$=null,e.__extendedByLocals$=null,l=e,k=h.__extendedByLocals$||{},g=j.maybeSync?2:4;break;case 2:return++g,{done:!1,value:j.maybeSync("",k,l)};case 3:m=a,g=5;break;case 4:m=j("",k,l),++g;case 5:g=l.__extendedBy$?6:8;break;case 6:return++g,{done:!1,value:l.__handleExtends$.call(l,m)};case 7:return g=9,{done:!0,value:a};case 8:return++g,{done:!0,value:m};case 9:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+g)}}function c(b){throw a(),b}function d(a){try{return b(a)}catch(d){c(d)}}var e,f,d,g,b,h,c,i,j,k,l,m;return h=this,g=0,{close:a,iterator:function(){return this},next:function(){return d(void 0)},send:d,"throw":function(a){return c(a),d(void 0)}}})),E=y,B=function(){function a(a){return c.test(a)?a.replace(b,"&amp;").replace(e,"&lt;").replace(d,"&gt;").replace(f,"&quot;"):a}var b,c,d,e,f;return c=/[&<>"]/,b=/&/g,e=/</g,d=/>/g,f=/"/g,function(b){if("string"==typeof b)return a(b);if("number"==typeof b)return b.toString();if(b&&"function"==typeof b.toHTML)return String(b.toHTML());throw new TypeError("Expected a String, Number, or Object with a toHTML method, got "+x(b))}}(),F=function(){function a(a,b,c,d,e){var f,g;return f=n(E),f.__currentFilepath$=b,f.__partialPrefix$=a,f.__fetchCompiled$=c,f.__extendedBy$=null,f.__extendedByLocals$=null,f.__inPartial$=!1,f.__inBlock$=!1,f.escape=d,g=n(I),g.__currentFilepath$=b,g.escape=d,e&&(r(g,e),r(f,e)),function(a){var b;return a?g:(b=n(f),b.__helpers$=b,b.__blocks$={},b)}}return function(b,c){return a("string"==typeof b.partialPrefix?b.partialPrefix:"_",b.filename,function(a){return c(a,this.__currentFilepath$)},"function"==typeof b.escape?b.escape:B,t.call(b,"context")?b.context:b)}}(),G=function(){function a(b,c){var d;if(d=this instanceof a?this:n(e),b&&"object"==typeof b&&null!==b)return a.call(d,null,b);if(b&&"0.3.1"!==b)throw new Error("EGS Packages must be compiled with the same version as the EGS runtime: '"+b+"' vs. '0.3.1'");return d.factories={},d.templates={},d.options=null!=c?c:{},d}function b(a){return 47!==a.charCodeAt(0)?"/"+a:a}function c(a,b,c){var d;return d=C(b,c),t.call(a,d)?o.fulfilled({filepath:d,compiled:{func:a[d],isSimple:!1}}):o.rejected(A("Cannot find '"+b+"' from '"+d+"', tried '"+d+"'"))}function d(a,d,e,f){var g,h;null==f&&(f={}),d=b(d),g=this.factories,h=g[d]=a?e:u(e),this.templates[d]=l(i(o.fulfilled({func:h,isSimple:!1})),F(r(r({__inPackage$:this,filename:d},this.options),f),function(a,b){return c(g,a,b)}),!0)}var e;return e=a.prototype,a.displayName="Package",e.set=function(a,b,c){return null==c&&(c={}),d.call(this,!1,a,b,c),this},e.setSimple=function(a,b,c){return null==c&&(c={}),d.call(this,!0,a,b,c),this},e.get=function(a){var c;if(a=b(a),c=this.templates,t.call(c,a))return c[a];throw A("Unknown filepath: '"+a+"'")},e.render=u(function(a,b){function c(){g=2}function d(c){for(;;)switch(g){case 0:return null==b&&(b={}),i=h.get(a),++g,{done:!1,value:i(b)};case 1:return++g,{done:!0,value:c};case 2:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,h,e,i;return h=this,g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),e.renderSync=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.sync(b)},e.renderStream=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.stream(b)},e.express=function(){var a;return a=this,function(b,c,d){p(a.render(b,c))(d)}},a}(),b.exports={version:"0.3.1",Package:G,EGSError:A,makeTemplate:l,makeHelpersFactory:F,guessFilepath:C,helperNames:function(){var a,b;a=[];for(b in D)t.call(D,b)&&a.push(b);return a}()}}.call(this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),b.exports};"function"==typeof define&&define.amd?define(b):"undefined"!=typeof module&&"function"==typeof require?module.exports=b():a.EGSRuntime=b()}(this);