!function(a){"use strict";var b=function(b){function c(a){var d=Object.prototype.hasOwnProperty;if(d.call(c._cache,a))return c._cache[a];if(d.call(c,a)){var e=c[a];return delete c[a],c._cache[a]=e.call({})}return b?b(a):void 0}return c._cache={},c["./egs"]=function(){var d={exports:this};return function(e){function f(d,e,f){var g;if(g=c(d))return g;if("function"==typeof define&&define.amd)return b(e);if("object"==typeof a&&null!==a){if(g=a[f],!g)throw new Error(f+" must be available before EGS is loaded");return g}throw new Error("Unable to detect runtime environment of EGS")}function g(a){var b;return function(){return a&&(b=a(),a=null),b}}function h(a,b){function c(c,f){var g,h;try{g=a[c](f)}catch(i){return t.rejected(i)}if(g.done)return t.fulfilled(g.value);if(h=a.flush())try{b(h)}catch(i){return t.rejected(i)}return g.value.then(d,e,!0)}function d(a){return c("send",a)}function e(a){return c("throw",a)}return d(void 0)}function i(a){return(a.open||"\0")+"\0"+(a.openWrite||"\0")+"\0"+(a.openComment||"\0")+"\0"+(a.openLiteral||"\0")+"\0"+(a.close||"\0")+"\0"+(a.closeWrite||"\0")+"\0"+(a.closeComment||"\0")+"\0"+(a.closeLiteral||"\0")+"\0"+String(a.cache)+"\0"+(a.prelude||"\0")}function j(a){return function(){return a}}function k(a){return null==a&&(a={}),{filename:a.filename,embeddedOpen:a.open,embeddedOpenWrite:a.openWrite,embeddedOpenComment:a.openComment,embeddedOpenLiteral:a.openLiteral,embeddedClose:a.close,embeddedCloseWrite:a.closeWrite,embeddedCloseComment:a.closeComment,embeddedCloseLiteral:a.closeLiteral,prelude:a.prelude,cache:a.cache,undefinedName:a.undefinedName,uglify:a.uglify}}function l(a){return{filename:a.filename,open:a.open,openWrite:a.openWrite,openComment:a.openComment,openLiteral:a.openLiteral,close:a.close,closeWrite:a.closeWrite,closeComment:a.closeComment,closeLiteral:a.closeLiteral,cache:a.cache,escape:a.escape,partialPrefix:a.partialPrefix,prelude:a.prelude,context:null}}function m(a){var b,c,d;if(b=z.call(a,"context")?a.context:a,d=["escape","extends","partial","block"].concat(D(cb)),b)for(c in b)z.call(b,c)&&!x(c,d)&&d.push(c);return d.sort()}function n(a,b,c){var d,e;return null==a&&(a=!1),null==c&&(c={context:null}),e=m(c),d=k(c),W(a?J(b,d,e):j(H(b,d,e)),V(c,function(a,b){return P.maybeSync(a,b,d,e)}),a?c.cache:!0)}function o(a,b){return null==b&&(b={context:null}),n(!1,a,b)}function p(a,b){return null==b&&(b={context:null}),b.filename=a,n(!0,a,b)}function q(a,b,c){var d;return null==b&&(b={context:null}),d=o(a,l(b)),c||(c=z.call(b,"context")?b.context:b),d.stream(c)}function r(a,b,c){var d;return null==b&&(b={context:null}),b.filename=a,d=p(a,l(b)),c||(c=z.call(b,"context")?b.context:b),d.stream(c)}function s(a,b,c){null==b&&(b={context:null}),u(ab(a,b))(c)}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb;if(t=function(){function a(){function b(a,b){var f;c&&(f=c,c=null,d=a,e=b,f.length&&bb(function(){var a,b;for(b=0,a=f.length;a>b;++b)f[b]()}))}var c,d,e;return d=!1,e=null,c=[],{promise:{then:function(b,f,g){function h(){var a,c;try{a=d?f:b,"function"==typeof a?(c=a(e),c&&"function"==typeof c.then?c.then(j,l,g):j(c)):(d?l:j)(e)}catch(h){l(h)}}var i,j,k,l;return g!==!0&&(g=void 0),i=a(),k=i.promise,j=i.fulfill,l=i.reject,i=null,c?c.push(h):g?h():bb(h),k},sync:function(){var a,b;switch(b=0,a=0,this.then(function(c){b=1,a=c},function(c){b=2,a=c},!0),b){case 0:throw new Error("Promise did not execute synchronously");case 1:return a;case 2:throw a;default:throw new Error("Unknown state")}}},fulfill:function(a){b(!1,a)},reject:function(a){b(!0,a)}}}return a.fulfilled=function(b){var c;return c=a(),c.fulfill(b),c.promise},a.rejected=function(b){var c;return c=a(),c.reject(b),c.promise},a}(),u=function(a){if("object"!=typeof a||null===a)throw new TypeError("Expected promise to be an Object, got "+F(a));if("function"!=typeof a.then)throw new TypeError("Expected promise.then to be a Function, got "+F(a.then));return function(b){if("function"!=typeof b)throw new TypeError("Expected callback to be a Function, got "+F(b));a.then(function(a){return bb(b,null,a)},function(a){return bb(b,a)})}},v=function(a,b){function c(c,f){var g;try{g=a[c](f)}catch(h){return t.rejected(h)}return g.done?t.fulfilled(g.value):g.value.then(d,e,b)}function d(a){return c("send",a)}function e(a){return c("throw",a)}if("object"!=typeof a||null===a)throw new TypeError("Expected generator to be an Object, got "+F(a));if("function"!=typeof a.send)throw new TypeError("Expected generator.send to be a Function, got "+F(a.send));if("function"!=typeof a["throw"])throw new TypeError("Expected generator.throw to be a Function, got "+F(a["throw"]));if(null==b)b=!1;else if("boolean"!=typeof b)throw new TypeError("Expected allowSync to be a Boolean, got "+F(b));return d(void 0)},w=function(a,b){var c;for(c in b)z.call(b,c)&&(a[c]=b[c]);return a},x="function"==typeof Array.prototype.indexOf?function(a){return function(b,c){return-1!==a.call(c,b)}}(Array.prototype.indexOf):function(a,b){var c,d;for(d=+b.length,c=-1;++c<d;)if(a===b[c]&&c in b)return!0;return!1},y="function"==typeof Array.isArray?Array.isArray:function(a){return function(b){return"[object Array]"===a.call(b)}}(Object.prototype.toString),z=Object.prototype.hasOwnProperty,A=function(a,b){var c;if(null==b)b=!1;else if("boolean"!=typeof b)throw new TypeError("Expected allowSync to be a Boolean, got "+F(b));return"function"==typeof a?(c=function(){return v(a.apply(this,arguments))},c.sync=function(){return v(a.apply(this,arguments),!0).sync()},c.maybeSync=function(){return v(a.apply(this,arguments),!0)},c):v(a,b)},B=function(a,b,c){function d(a){return++m,c(a).then(function(b){return l[a]=b,--m,e()},function(a){return g=!0,k(a)})}function e(){for(;!g&&a>m&&b>i;++i)d(i);return!g&&i>=b&&0===m?(g=!0,h(l)):void 0}var f,g,h,i,j,k,l,m;if("number"!=typeof a)throw new TypeError("Expected limit to be a Number, got "+F(a));if("number"!=typeof b)throw new TypeError("Expected length to be a Number, got "+F(b));if("function"!=typeof c)throw new TypeError("Expected body to be a Function, got "+F(c));return(1>a||a!==a)&&(a=1/0),l=[],g=!1,m=0,f=t(),h=f.fulfill,k=f.reject,j=f.promise,f=null,i=0,bb(e),j},C=Array.prototype.slice,D=function(a){if(null==a)throw new TypeError("Expected an object, got "+F(a));if(y(a))return a;if("string"==typeof a)return a.split("");if("number"==typeof a.length)return C.call(a);throw new TypeError("Expected an object with a length property, got "+F(a))},E=function(a,b,c){var d,e,f,g;if("function"!=typeof a)throw new TypeError("Expected func to be a Function, got "+F(a));return d=t(),f=d.promise,g=d.reject,e=d.fulfill,d=null,a.apply(b,D(c).concat([function(a,b){null!=a?g(a):e(b)}])),f},F=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),bb="function"==typeof e.setImmediate?e.setImmediate:"undefined"!=typeof process&&"function"==typeof process.nextTick?function(a){return function(b){var c;if("function"!=typeof b)throw new TypeError("Expected func to be a Function, got "+F(b));return c=C.call(arguments,1),c.length?a(function(){b.apply(void 0,D(c))}):a(b)}}(process.nextTick):function(a){var b;if("function"!=typeof a)throw new TypeError("Expected func to be a Function, got "+F(a));return b=C.call(arguments,1),b.length?setTimeout(function(){a.apply(void 0,b)},0):setTimeout(a,0)},Q=c("fs"),X=c("os"),$=c("path"),M=f("./runtime","egs-runtime","EGSRuntime"),Y=M.Package,L=M.EGSError,U=M.guessFilepath,cb=M.helperNames,W=M.makeTemplate,V=M.makeHelpersFactory,N=M.version,"0.3.1"!==N)throw new Error("EGS and its runtime must have the same version: '0.3.1' vs. '"+N+"'");T=f("gorillascript","gorillascript","GorillaScript"),G=function(){var a,b,c;return b=g(A(function(){function b(){f=5}function c(b){for(;;)switch(f){case 0:h=a,f=h?3:1;break;case 1:return++f,{done:!1,value:E(Q.readFile,Q,[__dirname+"/../src/egs-prelude.gs","utf8"])};case 2:h=b,++f;case 3:return++f,{done:!1,value:T.parse(h)};case 4:return g=b,++f,{done:!0,value:g.macros};case 5:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+f)}}function d(a){throw b(),a}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g,h;return f=0,{close:b,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}})),c={},[function(a){var d;return null==a&&(a=null),d=b(),a?c[a]||(c[a]=v(function(){function b(){g=4}function c(b){for(;;)switch(g){case 0:return++g,{done:!1,value:d};case 1:return h=b,++g,{done:!1,value:E(Q.readFile,Q,[a,"utf8"])};case 2:return j=b,++g,{done:!1,value:T.parse(j,{macros:h})};case 3:return i=b,++g,{done:!0,value:i.macros};case 4:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+g)}}function e(a){throw b(),a}function f(a){try{return c(a)}catch(b){e(b)}}var f,g,c,e,h,i,j;return g=0,{close:b,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}())):d},function(b){return a=b,this}]}(),S=G[0],db=G[1],G=null,R=function(){function a(a,b){var c;return a instanceof s.Call?(c=a.func,c instanceof s.Ident&&c.name===b):void 0}function b(a,b){var c,d,e;return a instanceof s.Call&&(c=a.func,c instanceof s.Binary&&"."===c.op)?(d=c.left,e=c.right,d instanceof s.Ident&&"context"===d.name&&e.isConst()&&e.constValue()===b):!1}function c(a){var b;if(a instanceof s.Call&&(b=a.func,b instanceof s.Binary&&"."===b.op&&b.left instanceof s.Ident&&"write"===b.left.name&&b.right.isConst()))switch(b.right.constValue()){case"call":return s.Block(a.pos,[a.args[0],s.Call(a.pos,b.left,C.call(a.args,1))]);case"apply":return s.Block(a.pos,[a.args[0],a.args[1].isNoop()?s.Call(a.pos,b.left,[s.IfExpression(a.args[1].pos,s.Access(a.args[1].pos,a.args[1],s.Const(a.args[1],1)),s.Call(a.pos,s.Access(a.pos,s.Ident(a.pos,"context"),s.Const(a.pos,"escape")),[s.Access(a.args[1].pos,a.args[1],s.Const(a.args[1],0))]),s.Access(a.args[1].pos,a.args[1],s.Const(a.args[1],0)))]):s.Call(a.pos,b.left,[s.Call(a.args[1].pos,s.Access(a.pos,s.Ident(a.pos,"context"),s.Const(a.args[1].pos,"__maybeEscape")),[s.Access(a.pos,s.Ident(a.pos,"context"),s.Const(a.pos,"escape")),a.args[1]])])]);default:return}}function d(b){return a(b,"write")&&2===b.args.length&&b.args[1].isConst()&&b.args[1].constValue()?s.Call(b.pos,b.func,[s.Call(b.pos,s.Access(b.pos,s.Ident(b.pos,"context"),s.Const(b.pos,"escape")),[b.args[0]])]):void 0}function e(a){var c;return b(a,"escape")&&1===a.args.length&&(c=a.args[0],c&&(b(c,"h")||b(c,"html"))&&1===c.args.length)?c.args[0]:void 0}function f(a){var c;return a.isConst()?"string"!=typeof a.constValue():a instanceof s.Binary?"+"===a.op?f(a.left)&&f(a.right):!0:a instanceof s.IfExpression?f(a.whenTrue)||f(a.whenFalse):a instanceof s.BlockExpression||a instanceof s.BlockStatement?f((c=a.body)[c.length-1]):!b(a,"escape")}function g(b){var c,d,e,h,i,j,k,l,m,n,o;if(b instanceof s.BlockExpression||b instanceof s.BlockStatement){for(e=b.body.slice(),h=!1,c=D(e),i=0,d=c.length;d>i;++i)m=c[i],e[i]=k=m.walkWithThis(g),k!==m&&(h=!0);for(i=0;i<e.length-1;)j=e[i],l=e[i+1],a(j,"write")&&1===j.args.length&&a(l,"write")&&1===l.args.length?(h=!0,e.splice(i,2,s.Call(j.pos,j.func,[s.Binary(j.pos,f(j.args[0])&&f(l.args[0])?s.Binary(j.pos,s.Const(j.pos,""),"+",j.args[0]):j.args[0],"+",l.args[0])]))):++i;if(h)return s.Block(b.pos,e,b.label)}else if((b instanceof s.IfStatement||b instanceof s.IfExpression)&&!b.label&&(o=b.whenTrue.walkWithThis(g),n=b.whenFalse.walkWithThis(g),a(o,"write")&&(a(n,"write")||n.isNoop())))return s.Call(b.pos,o.func,[s.IfExpression(b.pos,b.test.walkWithThis(g),o.args[0],n.isNoop()?s.Const(n.pos,""):n.args[0])])}function h(a){var c;c={};try{a.walk(function(a){if(a instanceof s.Func)return a;if(b(a,"extends"))throw c})}catch(d){if(d===c)return!0;throw d}return!1}function i(b){return b instanceof s.Func?b:a(b,"write")?s.Noop(b.pos):void 0}function j(a){return a instanceof s.Func&&h(a)?a.walk(i):void 0}function k(b){return a(b,"write")?s.Binary(b.pos,b.func,"+=",b.args[0]).walk(k):void 0}function l(a,b){return b instanceof s.Binary&&"+"===b.op?s.Binary(a.pos,l(a,b.left),"+",b.right):s.Binary(a.pos,a,"+",b)}function m(a){var b,c,d;return a instanceof s.BlockStatement&&(d=(b=a.body)[b.length-1],d instanceof s.Return&&d.node instanceof s.Ident&&"write"===d.node.name&&(c=(b=a.body)[b.length-2],c&&c instanceof s.Binary&&"+="===c.op&&c.left instanceof s.Ident&&"write"===c.left.name))?s.BlockStatement(a.pos,D(C.call(a.body,0,-2)).concat([s.Return(c.pos,l(c.left,c.right))]),a.label):void 0}function n(a){return a instanceof s.Binary&&"=="===a.op&&a.left instanceof s.Ident&&"context"===a.left.name&&a.right.isConst()&&null==a.right.constValue()?s.Const(a.pos,!1):void 0}function o(a){return function(b){return b instanceof s.Binary&&"."===b.op&&b.left instanceof s.Ident&&"context"===b.left.name&&b.right.isConst()&&x(b.right.constValue(),a)?s.Binary(b.pos,s.Ident(b.left.pos,"helpers"),".",b.right):void 0}}function p(a){return a instanceof s.Func&&2===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name?s.Func(a.pos,a.name,[a.params[0],a.params[1],s.Ident(a.pos,"helpers")],a.variables,a.body,a.declarations):void 0}function q(a){var b,c,d;return a instanceof s.Func&&3===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name&&"helpers"===a.params[2].name&&a.body instanceof s.BlockStatement&&(c=(b=a.body.body)[b.length-1],c instanceof s.Return&&c.node instanceof s.Obj)?(d=c.pos,s.Func(a.pos,a.name,a.params,a.variables,s.BlockStatement(a.body.pos,D(C.call(a.body.body,0,-1)).concat([s.Return(d,s.Obj(c.node.pos,D(c.node.elements).concat([s.Obj.Pair(d,"flush",s.Func(d,null,[],["flushed"],s.Block(d,[s.Assign(d,s.Ident(d,"flushed"),s.Ident(d,"write")),s.Assign(d,s.Ident(d,"write"),s.Const(d,"")),s.Return(d,s.Ident(d,"flushed"))])))])))])),a.declarations)):void 0}function r(b){var c;return a(b,"__generator")&&(c=b.args[0],c instanceof s.Func&&3===c.params.length&&"write"===c.params[0].name&&"context"===c.params[1].name&&"helpers"===c.params[2].name)?c:void 0}var s;return s=T.AST,function(a){return function(b){return b.walk(c).walk(d).walk(e).walk(g).walk(j).walk(k).walk(m).walk(n).walk(o(a)).walk(p).walk(q).walk(r)}}}(),I=A(function(a,b,c){function d(){j=7}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:S(b.prelude)};case 1:o=d,l=R(c),i=w({},b),i.embedded=!0,i.noindent=!0,i.macros=o,i.prelude=null,i.astPipe=l,p=i,n=!1,++j;case 2:return++j,{done:!1,value:T.compile(a,p)};case 3:k=d,m=k.code,j=6;break;case 4:return p.embeddedGenerator=!0,n=!0,++j,{done:!1,value:T.compile(a,p)};case 5:k=d,m=k.code,++j;case 6:return++j,{done:!0,value:{isGenerator:n,code:m}};case 7:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+j)}}function f(a){if(2!==j&&3!==j)throw d(),a;h=a,j=4}function g(a){for(;;)try{return e(a)}catch(b){f(b)}}var h,i,g,j,e,f,k,l,m,n,o,p;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),H=A(function(a,b,c){function d(){j=2}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:I(a,b,c)};case 1:return i=d,m=i.isGenerator,k=i.code,i=null,++j,{done:!0,value:{func:m?(l=Function("return "+k)(),n=A(l),n.stream=function(a){var b,c;return b=C.call(arguments,1),c=l.apply(this,b),c.flush?h(c,a):v(c)},n):Function("return "+k)(),isSimple:function(){var a,b,c,d,e;for(b=!0,a=["extends","partial","block"],c=0,d=a.length;d>c;++c)if(e=a[c],-1!==k.indexOf("helpers."+e)||-1!==k.indexOf('helpers["'+e+'"]')){b=!1;break}return b}()}};case 2:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+j)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var i,g,j,e,f,k,l,m,n;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),J=function(){var a;return a={},function(b,c,d){var e,f;return f=a[b]||(a[b]={}),f[e=i(c)+"\0"+d.join("\0")]||(f[e]=function(){var a,e,f,g;return f=A(function(){function a(){h=3}function e(a){for(;;)switch(h){case 0:return++h,{done:!1,value:E(Q.readFile,Q,[b,"utf8"])};case 1:return i=a,++h,{done:!1,value:H(i,c,d)};case 2:return++h,{done:!0,value:a};case 3:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+h)}}function f(b){throw a(),b}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:a,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),c.cache?j(f()):(g=A(function(){function a(){f=2}function c(a){for(;;)switch(f){case 0:return++f,{done:!1,value:E(Q.stat,Q,[b])};case 1:return g=a,++f,{done:!0,value:g.mtime.getTime()};case 2:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+f)}}function d(b){throw a(),b}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g;return f=0,{close:a,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}}),a=f(),e=g(),A(function(){function b(){i=4}function c(b){for(;;)switch(i){case 0:return k=g(),++i,{done:!1,value:e};case 1:return j=b,++i,{done:!1,value:k};case 2:return j=j!==b,j&&(a=f(),e=k),++i,{done:!1,value:a};case 3:return++i,{done:!0,value:b};case 4:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+i)}}function d(a){throw b(),a}function h(a){try{return c(a)}catch(b){d(b)}}var h,i,c,d,j,k;return i=0,{close:b,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return d(a),h(void 0)}}}))}())}}(),P=A(function(a,b,c,d){function e(){i=2}function f(e){for(;;)switch(i){case 0:return null==c&&(c={}),k=U(a,b),++i,{done:!1,value:J(k,c,d)()};case 1:return j=e,++i,{done:!0,value:{filepath:k,compiled:j}};case 2:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+i)}}function g(a){throw e(),a}function h(a){try{return f(a)}catch(b){g(b)}}var h,i,f,g,j,k;return i=0,{close:e,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return g(a),h(void 0)}}}),_=A(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),i=o(a,l(b)),c||(c=z.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),ab=A(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),b.filename=a,i=p(a,l(b)),c||(c=z.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),O=A(function(a,b){function c(){g=3}function d(c){for(;;)switch(g){case 0:return++g,{done:!1,value:E(Q.readdir,Q,[a])};case 1:return h=c,i=[],++g,{done:!1,value:B(3,+h.length,A(function(c){function d(){k=6}function e(d){for(;;)switch(k){case 0:return m=h[c],l=$.join(a,m),++k,{done:!1,value:E(Q.stat,Q,[l])};case 1:n=d,k=n.isDirectory()?2:4;break;case 2:return j=[],++k,{done:!1,value:O(l,b)};case 3:return j.push.apply(j,D(d)),k=6,{done:!0,value:i.push.apply(i,j)};case 4:k=n.isFile()&&$.extname(m)===b?5:6;break;case 5:return++k,{done:!0,value:i.push(l)};case 6:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+k)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var j,g,k,e,f,l,m,n;return k=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}))};case 2:return++g,{done:!0,value:i.sort()};case 3:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h,i;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),K=A(function(a,b,c){function d(){i=9}function e(b,d,e){function f(a){var b;return a instanceof e.Call&&(a.func instanceof e.Func||a.func instanceof e.Binary&&"."===a.func.op&&a.func.left instanceof e.Func&&a.func.right.isConst()&&("call"===(b=a.func.right.constValue())||"apply"===b))}function g(a){for(;f(a);)a=a.func instanceof e.Func?a.func.body:a.func.left.body;return a}function h(a){var b;return a instanceof e.BlockStatement||a instanceof e.BlockExpression?(b=a.body)[b.length-1]:a}function i(a){var b;return a=h(g(a)),a instanceof e.Return&&a.node instanceof e.Func&&(b=h(g(a.node.body)),b instanceof e.Return&&!(b.node instanceof e.Obj))?!1:!0}function k(b){return b.pos.file&&!z.call(m,b.pos.file)&&f(b)?(m[b.pos.file]=!0,e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"templates"),e.Const(b.pos,i(b)?"set":"setSimple")),[e.Const(b.pos,$.relative(a,b.pos.file)),b])):void 0}var m;return m={},b=j(b).walk(k),l?e.Root(b.pos,e.Call(b.pos,e.Access(b.pos,e.Func(b.pos,null,[e.Ident(b.pos,"factory")],[],e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"module")),"!==",e.Const(b.pos,"undefined")),e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports"))),e.Assign(b.pos,e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports")),e.Call(b.pos,e.Ident(b.pos,"factory"))),e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"define")),"===",e.Const(b.pos,"function")),e.Access(b.pos,e.Ident(b.pos,"define"),e.Const(b.pos,"amd"))),e.Call(b.pos,e.Ident(b.pos,"define"),[e.Ident(b.pos,"factory")]),e.Assign(b.pos,e.Access(b.pos,e.This(b.pos),e.Const(b.pos,c.globalExport||"EGSTemplates")),e.Call(b.pos,e.Ident(b.pos,"factory")))))),e.Const(b.pos,"call")),[e.This(b.pos),e.Func(b.pos,null,[],["templates","EGSRuntime"],e.Block(b.pos,[e.Assign(b.pos,e.Ident(b.pos,"EGSRuntime"),e.Eval(b.pos,("(function () {\n  var exports = {};\n  var module = { exports: exports };\n\n  "+p.split("\n").join("\n  ")+"\n\n  return module.exports;\n}.call(this))").split("\n").join("\n  "))),e.Assign(b.pos,e.Ident(b.pos,"templates"),e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"EGSRuntime"),e.Const(b.pos,"Package")),[e.Const(b.pos,"0.3.1")])),b.body,e.Return(b.pos,e.Ident(b.pos,"templates"))]))]),[],[]):e.Root(b.pos,e.Call(b.pos,e.Access(b.pos,e.Func(b.pos,null,[e.Ident(b.pos,"factory")],[],e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"module")),"!==",e.Const(b.pos,"undefined")),e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports"))),e.Assign(b.pos,e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Call(b.pos,e.Ident(b.pos,"require"),[e.Const(b.pos,"egs")])])),e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"define")),"===",e.Const(b.pos,"function")),e.Access(b.pos,e.Ident(b.pos,"define"),e.Const(b.pos,"amd"))),e.Call(b.pos,e.Ident(b.pos,"define"),[e.Arr(b.pos,[e.Const(b.pos,"egs-runtime")]),e.Ident(b.pos,"factory")]),e.Assign(b.pos,e.Access(b.pos,e.This(b.pos),e.Const(b.pos,c.globalExport||"EGSTemplates")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Access(b.pos,e.This(b.pos),e.Const(b.pos,"EGSRuntime"))]))))),e.Const(b.pos,"call")),[e.This(b.pos),e.Func(b.pos,null,[e.Ident(b.pos,"EGSRuntime")],["templates"],e.Block(b.pos,[e.IfStatement(b.pos,e.Unary(b.pos,"!",e.Ident(b.pos,"EGSRuntime")),e.Throw(b.pos,e.Call(b.pos,e.Ident(b.pos,"Error"),[e.Const(b.pos,"Expected EGSRuntime to be available")]))),e.Assign(b.pos,e.Ident(b.pos,"templates"),e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"EGSRuntime"),e.Const(b.pos,"Package")),[e.Const(b.pos,"0.3.1")])),b.body,e.Return(b.pos,e.Ident(b.pos,"templates"))]))]),[],[])}function f(d){for(;;)switch(i){case 0:return null==c&&(c={}),++i,{done:!1,value:E(Q.stat,Q,[a])};case 1:if(k=d,!k.isDirectory())throw new Error("Expected '"+a+"' to be a directory.");return++i,{done:!1,value:O(a,".egs")};case 2:return n=d,++i,{done:!1,value:S(c.prelude)};case 3:o=d,j=R(m({})),l=c.includeEgsRuntime,i=l?4:6;break;case 4:return++i,{done:!1,value:E(Q.readFile,Q,[$.join(__dirname,"..","lib","runtime.js"),"utf8"])};case 5:p=d,i=7;break;case 6:++i;case 7:return++i,{done:!1,value:T.compileFile({input:n,output:b,embedded:!0,embeddedGenerator:!0,noindent:!0,embeddedOpen:c.open,embeddedOpenWrite:c.openWrite,embeddedOpenComment:c.openComment,embeddedOpenLiteral:c.openLiteral,embeddedClose:c.close,embeddedCloseWrite:c.closeWrite,embeddedCloseComment:c.closeComment,embeddedCloseLiteral:c.closeLiteral,coverage:c.coverage,sourceMap:c.sourceMap,undefinedName:c.undefinedName,uglify:c.uglify,encoding:c.encoding,linefeed:c.linefeed,macros:o,astPipe:e})};case 8:return++i,{done:!0,value:d};case 9:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+i)}}function g(a){throw d(),a}function h(a){try{return f(a)}catch(b){g(b)}}var h,i,f,g,j,k,l,n,o,p;return i=0,{close:d,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return g(a),h(void 0)}}}),eb=g(function(){var a,b;return a=c("module"),b=a._resolveFilename,a._resolveFilename=function(a){return"egs"===a?$.resolve(__dirname,"../index.js"):b.apply(this,arguments)}}),Z=A(function(a,b){function d(){h=3}function e(){for(;;)switch(h){case 0:return null==b&&(b={}),j="egs-package-"+(new Date).getTime()+"-"+Math.random().toString(36).slice(2)+".js",k=$.join(X.tmpdir(),j),++h,{done:!1,value:K(a,k,b)};case 1:if(eb(),i=c(k),!(i instanceof Y))throw new Error("Package did not build successfully");return++h,{done:!1,value:E(Q.unlink,Q,[k])};case 2:return++h,{done:!0,value:i};case 3:return{done:!0,value:void 0};default:throw new Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i,j,k;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),o.version="0.3.1",o.fromFile=p,o.render=_,o.renderFile=ab,o.renderStream=q,o.renderFileStream=r,o.withEgsPrelude=db,o.compilePackage=K,o.packageFromDirectory=Z,o.Package=Y,o.EGSError=L,o.compile=function(a,b,c){return null==a&&(a=""),null==b&&(b={}),null==c&&(c=[]),I(a,k(b),c)},o.__express=s,o.express=function(a){return null==a&&(a={}),function(b,c,d){null==c&&(c={}),s(b,w(w({},a),c),d)}},d.exports=o}.call(this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),d.exports},c("./egs").withEgsPrelude("macro extends(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE context.extends $name, $new-context\n\nmacro block\n  syntax ident as Identifier, body as GeneratorBody?\n    let name = @const ident.name\n    if body?\n      ASTE! write := yield context.block $name, first!(write, (write := '')), #(write)*\n        $body\n        write\n    else\n      ASTE! write := yield context.block $name, first!(write, (write := ''))\n\nmacro partial(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  \n  ASTE! write := yield context.partial $name, first!(write, (write := '')), $new-context\n")};"function"==typeof define&&define.amd?define(["require","gorillascript","egs-runtime"],function(a){return b(a)}):"undefined"!=typeof module&&"function"==typeof require?module.exports=b(require):a.EGS=b()}(this);