!function(a){"use strict";var b=function(b){function c(a){var d=Object.prototype.hasOwnProperty;if(d.call(c._cache,a))return c._cache[a];if(d.call(c,a)){var e=c[a];return delete c[a],c._cache[a]=e.call({})}return b?b(a):void 0}return c._cache={},c["./egs"]=function(){var d={exports:this};return function(e){function f(d,e,f){var g;if(g=c(d))return g;if("function"==typeof define&&define.amd)return b(e);if("object"==typeof a&&null!==a){if(g=a[f],!g)throw Error(f+" must be available before EGS is loaded");return g}throw Error("Unable to detect runtime environment of EGS")}function g(a){var b;return function(){return a&&(b=a(),a=null),b}}function h(a,b){function c(c,f){var g,h;try{g=a[c](f)}catch(i){return t.rejected(i)}if(g.done)return t.fulfilled(g.value);if(h=a.flush())try{b(h)}catch(i){return t.rejected(i)}return g.value.then(d,e,!0)}function d(a){return c("send",a)}function e(a){return c("throw",a)}return d(void 0)}function i(a){return(a.open||"\0")+"\0"+(a.openWrite||"\0")+"\0"+(a.openComment||"\0")+"\0"+(a.openLiteral||"\0")+"\0"+(a.close||"\0")+"\0"+(a.closeWrite||"\0")+"\0"+(a.closeComment||"\0")+"\0"+(a.closeLiteral||"\0")+"\0"+String(a.cache)+"\0"+(a.prelude||"\0")}function j(a){return function(){return a}}function k(a){return null==a&&(a={}),{filename:a.filename,embeddedOpen:a.open,embeddedOpenWrite:a.openWrite,embeddedOpenComment:a.openComment,embeddedOpenLiteral:a.openLiteral,embeddedClose:a.close,embeddedCloseWrite:a.closeWrite,embeddedCloseComment:a.closeComment,embeddedCloseLiteral:a.closeLiteral,prelude:a.prelude,cache:a.cache,undefinedName:a.undefinedName,uglify:a.uglify}}function l(a){return{filename:a.filename,open:a.open,openWrite:a.openWrite,openComment:a.openComment,openLiteral:a.openLiteral,close:a.close,closeWrite:a.closeWrite,closeComment:a.closeComment,closeLiteral:a.closeLiteral,cache:a.cache,escape:a.escape,partialPrefix:a.partialPrefix,prelude:a.prelude,context:null}}function m(a){var b,c,d;if(b=z.call(a,"context")?a.context:a,d=["escape","extends","partial","block"].concat(D(cb)),b)for(c in b)z.call(b,c)&&!x(c,d)&&d.push(c);return d.sort()}function n(a,b,c){var d,e;return null==a&&(a=!1),null==c&&(c={context:null}),e=m(c),d=k(c),W(a?J(b,d,e):j(H(b,d,e)),V(c,function(a,b){return P.maybeSync(a,b,d,e)}),a?c.cache:!0)}function o(a,b){return null==b&&(b={context:null}),n(!1,a,b)}function p(a,b){return null==b&&(b={context:null}),b.filename=a,n(!0,a,b)}function q(a,b,c){var d;return null==b&&(b={context:null}),d=o(a,l(b)),c||(c=z.call(b,"context")?b.context:b),d.stream(c)}function r(a,b,c){var d;return null==b&&(b={context:null}),b.filename=a,d=p(a,l(b)),c||(c=z.call(b,"context")?b.context:b),d.stream(c)}function s(a,b,c){null==b&&(b={context:null}),u(ab(a,b))(c)}var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db;if(t=function(){function a(){function b(a,b){var f;c&&(f=c,c=null,d=a,e=b,f.length&&bb(function(){var a,b;for(b=0,a=f.length;a>b;++b)f[b]()}))}var c,d,e;return d=!1,e=null,c=[],{promise:{then:function(b,f,g){function h(){var a,c;try{a=d?f:b,"function"==typeof a?(c=a(e),c&&"function"==typeof c.then?c.then(j,l,g):j(c)):(d?l:j)(e)}catch(h){l(h)}}var i,j,k,l;return g!==!0&&(g=void 0),i=a(),k=i.promise,j=i.fulfill,l=i.reject,c?c.push(h):g?h():bb(h),k},sync:function(){var a,b;switch(b=0,a=0,this.then(function(c){return b=1,a=c},function(c){return b=2,a=c},!0),b){case 0:throw Error("Promise did not execute synchronously");case 1:return a;case 2:throw a;default:throw Error("Unknown state")}}},fulfill:function(a){b(!1,a)},reject:function(a){b(!0,a)}}}return a.fulfilled=function(b){var c;return c=a(),c.fulfill(b),c.promise},a.rejected=function(b){var c;return c=a(),c.reject(b),c.promise},a}(),u=function(a){if("object"!=typeof a||null===a)throw TypeError("Expected promise to be an Object, got "+F(a));if("function"!=typeof a.then)throw TypeError("Expected promise.then to be a Function, got "+F(a.then));return function(b){a.then(function(a){return bb(b,null,a)},function(a){return bb(b,a)})}},v=function(a,b){function c(c,f){var g;try{g=a[c](f)}catch(h){return t.rejected(h)}return g.done?t.fulfilled(g.value):g.value.then(d,e,b)}function d(a){return c("send",a)}function e(a){return c("throw",a)}if("object"!=typeof a||null===a)throw TypeError("Expected generator to be an Object, got "+F(a));if("function"!=typeof a.send)throw TypeError("Expected generator.send to be a Function, got "+F(a.send));if("function"!=typeof a["throw"])throw TypeError("Expected generator.throw to be a Function, got "+F(a["throw"]));if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+F(b));return d(void 0)},w=function(a,b){var c;for(c in b)z.call(b,c)&&(a[c]=b[c]);return a},x="function"==typeof Array.prototype.indexOf?function(){var a;return a=Array.prototype.indexOf,function(b,c){return-1!==a.call(c,b)}}():function(a,b){var c,d;for(d=+b.length,c=-1;++c<d;)if(a===b[c]&&c in b)return!0;return!1},y="function"==typeof Array.isArray?Array.isArray:function(){var a;return a=Object.prototype.toString,function(b){return"[object Array]"===a.call(b)}}(),z=Object.prototype.hasOwnProperty,A=function(a,b){var c;if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+F(b));return"function"==typeof a?(c=function(){return v(a.apply(this,arguments))},c.sync=function(){return v(a.apply(this,arguments),!0).sync()},c.maybeSync=function(){return v(a.apply(this,arguments),!0)},c):v(a,b)},B=function(a,b,c){function d(a){return++j,c(a).then(function(b){return i[a]=b,--j,e()},function(a){return g=!0,f.reject(a)})}function e(){for(;!g&&a>j&&b>h;++h)d(h);return!g&&h>=b&&0===j?(g=!0,f.fulfill(i)):void 0}var f,g,h,i,j;if("number"!=typeof a)throw TypeError("Expected limit to be a Number, got "+F(a));if("number"!=typeof b)throw TypeError("Expected length to be a Number, got "+F(b));if("function"!=typeof c)throw TypeError("Expected body to be a Function, got "+F(c));return(1>a||a!==a)&&(a=1/0),i=[],g=!1,j=0,f=t(),h=0,bb(e),f.promise},C=Array.prototype.slice,D=function(a){if(null==a)throw TypeError("Expected an object, got "+F(a));if(y(a))return a;if("string"==typeof a)return a.split("");if("number"==typeof a.length)return C.call(a);throw TypeError("Expected an object with a length property, got "+F(a))},E=function(a,b,c){var d;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+F(a));return d=t(),a.apply(b,D(c).concat([function(a,b){null!=a?d.reject(a):d.fulfill(b)}])),d.promise},F=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),bb="function"==typeof e.setImmediate?e.setImmediate:"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){var a;return a=process.nextTick,function(b){var c;if("function"!=typeof b)throw TypeError("Expected func to be a Function, got "+F(b));return c=C.call(arguments,1),c.length?a(function(){b.apply(void 0,D(c))}):a(b)}}():function(a){var b;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+F(a));return b=C.call(arguments,1),b.length?setTimeout(function(){a.apply(void 0,D(b))},0):setTimeout(a,0)},Q=c("fs"),X=c("os"),$=c("path"),M=f("./runtime","egs-runtime","EGSRuntime"),Y=M.Package,L=M.EGSError,U=M.guessFilepath,cb=M.helperNames,W=M.makeTemplate,V=M.makeHelpersFactory,N=M.version,"0.2.2"!==N)throw Error("EGS and its runtime must have the same version: '0.2.2' vs. '"+N+"'");T=f("gorillascript","gorillascript","GorillaScript"),G=function(){var a,b,c;return b=g(A(function(){function b(){f=5}function c(b){for(;;)switch(f){case 0:h=a,f=h?3:1;break;case 1:return++f,{done:!1,value:E(Q.readFile,Q,[__dirname+"/../src/egs-prelude.gs","utf8"])};case 2:h=b,++f;case 3:return++f,{done:!1,value:T.parse(h)};case 4:return g=b,++f,{done:!0,value:g.macros};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+f)}}function d(a){throw b(),a}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g,h;return f=0,{close:b,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}})),c={},[function(a){var d;return null==a&&(a=null),d=b(),a?z.call(c,a)?c[a]:c[a]=v(function(){function b(){g=4}function c(b){for(;;)switch(g){case 0:return++g,{done:!1,value:d};case 1:return h=b,++g,{done:!1,value:E(Q.readFile,Q,[a,"utf8"])};case 2:return j=b,++g,{done:!1,value:T.parse(j,{macros:h})};case 3:return i=b,++g,{done:!0,value:i.macros};case 4:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw b(),a}function f(a){try{return c(a)}catch(b){e(b)}}var f,g,c,e,h,i,j;return g=0,{close:b,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}()):d},function(b){return a=b,this}]}(),S=G[0],db=G[1],R=function(){function a(a,b){var c;return a instanceof r.Call?(c=a.func,c instanceof r.Ident&&c.name===b):void 0}function b(a,b){var c,d,e;return a instanceof r.Call&&(c=a.func,c instanceof r.Binary&&"."===c.op)?(d=c.left,e=c.right,d instanceof r.Ident&&"context"===d.name&&e.isConst()&&e.constValue()===b):!1}function c(a){var b;if(a instanceof r.Call&&(b=a.func,b instanceof r.Binary&&"."===b.op&&b.left instanceof r.Ident&&"write"===b.left.name&&b.right.isConst()))switch(b.right.constValue()){case"call":return r.Block(a.pos,[a.args[0],r.Call(a.pos,b.left,C.call(a.args,1))]);case"apply":return r.Block(a.pos,[a.args[0],a.args[1].isNoop()?r.Call(a.pos,b.left,[r.IfExpression(a.args[1].pos,r.Access(a.args[1].pos,a.args[1],r.Const(a.args[1],1)),r.Call(a.pos,r.Access(a.pos,r.Ident(a.pos,"context"),r.Const(a.pos,"escape")),[r.Access(a.args[1].pos,a.args[1],r.Const(a.args[1],0))]),r.Access(a.args[1].pos,a.args[1],r.Const(a.args[1],0)))]):r.Call(a.pos,b.left,[r.Call(a.args[1].pos,r.Access(a.pos,r.Ident(a.pos,"context"),r.Const(a.args[1].pos,"__maybeEscape")),[r.Access(a.pos,r.Ident(a.pos,"context"),r.Const(a.pos,"escape")),a.args[1]])])]);default:return}}function d(b){return a(b,"write")&&2===b.args.length&&b.args[1].isConst()&&b.args[1].constValue()?r.Call(b.pos,b.func,[r.Call(b.pos,r.Access(b.pos,r.Ident(b.pos,"context"),r.Const(b.pos,"escape")),[b.args[0]])]):void 0}function e(a){var c;return b(a,"escape")&&1===a.args.length&&(c=a.args[0],c&&(b(c,"h")||b(c,"html"))&&1===c.args.length)?c.args[0]:void 0}function f(a){var c;return a.isConst()?"string"!=typeof a.constValue():a instanceof r.Binary?"+"===a.op?f(a.left)&&f(a.right):!0:a instanceof r.IfExpression?f(a.whenTrue)||f(a.whenFalse):a instanceof r.BlockExpression||a instanceof r.BlockStatement?f((c=a.body)[c.length-1]):!b(a,"escape")}function g(b){var c,d,e,h,i,j,k,l,m,n,o;if(b instanceof r.BlockExpression||b instanceof r.BlockStatement){for(e=b.body.slice(),h=!1,c=D(e),i=0,d=c.length;d>i;++i)m=c[i],k=m.walkWithThis(g),e[i]=k,k!==m&&(h=!0);for(i=0;i<e.length-1;)j=e[i],l=e[i+1],a(j,"write")&&1===j.args.length&&a(l,"write")&&1===l.args.length?(h=!0,e.splice(i,2,r.Call(j.pos,j.func,[r.Binary(j.pos,f(j.args[0])&&f(l.args[0])?r.Binary(j.pos,r.Const(j.pos,""),"+",j.args[0]):j.args[0],"+",l.args[0])]))):++i;if(h)return r.Block(b.pos,e,b.label)}else if((b instanceof r.IfStatement||b instanceof r.IfExpression)&&!b.label&&(o=b.whenTrue.walkWithThis(g),n=b.whenFalse.walkWithThis(g),a(o,"write")&&(a(n,"write")||n.isNoop())))return r.Call(b.pos,o.func,[r.IfExpression(b.pos,b.test.walkWithThis(g),o.args[0],n.isNoop()?r.Const(n.pos,""):n.args[0])])}function h(a){var c;c={};try{a.walk(function(a){if(a instanceof r.Func)return a;if(b(a,"extends"))throw c})}catch(d){if(d===c)return!0;throw d}return!1}function i(b){return b instanceof r.Func?b:a(b,"write")?r.Noop(b.pos):void 0}function j(a){return a instanceof r.Func&&h(a)?a.walk(i):void 0}function k(b){return a(b,"write")?r.Binary(b.pos,b.func,"+=",b.args[0]).walk(k):void 0}function l(a,b){return b instanceof r.Binary&&"+"===b.op?r.Binary(a.pos,l(a,b.left),"+",b.right):r.Binary(a.pos,a,"+",b)}function m(a){var b,c,d;return a instanceof r.BlockStatement&&(d=(b=a.body)[b.length-1],d instanceof r.Return&&d.node instanceof r.Ident&&"write"===d.node.name&&(c=(b=a.body)[b.length-2],c&&c instanceof r.Binary&&"+="===c.op&&c.left instanceof r.Ident&&"write"===c.left.name))?r.BlockStatement(a.pos,D(C.call(a.body,0,-2)).concat([r.Return(c.pos,l(c.left,c.right))]),a.label):void 0}function n(a){return a instanceof r.Binary&&"=="===a.op&&a.left instanceof r.Ident&&"context"===a.left.name&&a.right.isConst()&&null==a.right.constValue()?r.Const(a.pos,!1):void 0}function o(a){return function(b){return b instanceof r.Binary&&"."===b.op&&b.left instanceof r.Ident&&"context"===b.left.name&&b.right.isConst()&&x(b.right.constValue(),a)?r.Binary(b.pos,r.Ident(b.left.pos,"helpers"),".",b.right):void 0}}function p(a){return a instanceof r.Func&&2===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name?r.Func(a.pos,a.name,[a.params[0],a.params[1],r.Ident(a.pos,"helpers")],a.variables,a.body,a.declarations):void 0}function q(a){var b,c,d;return a instanceof r.Func&&3===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name&&"helpers"===a.params[2].name&&a.body instanceof r.BlockStatement&&(c=(b=a.body.body)[b.length-1],c instanceof r.Return&&c.node instanceof r.Obj)?(d=c.pos,r.Func(a.pos,a.name,a.params,a.variables,r.BlockStatement(a.body.pos,D(C.call(a.body.body,0,-1)).concat([r.Return(d,r.Obj(c.node.pos,D(c.node.elements).concat([r.Obj.Pair(d,"flush",r.Func(d,null,[],["flushed"],r.Block(d,[r.Assign(d,r.Ident(d,"flushed"),r.Ident(d,"write")),r.Assign(d,r.Ident(d,"write"),r.Const(d,"")),r.Return(d,r.Ident(d,"flushed"))])))])))])),a.declarations)):void 0}var r;return r=T.AST,function(a){return function(b){return b.walk(c).walk(d).walk(e).walk(g).walk(j).walk(k).walk(m).walk(n).walk(o(a)).walk(p).walk(q)}}}(),I=A(function(a,b,c){function d(){j=7}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:S(b.prelude)};case 1:o=d,l=R(c),i=w({},b),i.embedded=!0,i.noindent=!0,i.macros=o,i.prelude=null,i.astPipe=l,p=i,n=!1,++j;case 2:return++j,{done:!1,value:T.compile(a,p)};case 3:k=d,m=k.code,j=6;break;case 4:return p.embeddedGenerator=!0,n=!0,++j,{done:!1,value:T.compile(a,p)};case 5:k=d,m=k.code,++j;case 6:return++j,{done:!0,value:{isGenerator:n,code:m}};case 7:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){if(2!==j&&3!==j)throw d(),a;h=a,j=4}function g(a){for(;;)try{return e(a)}catch(b){f(b)}}var h,i,g,j,e,f,k,l,m,n,o,p;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),H=A(function(a,b,c){function d(){j=2}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:I(a,b,c)};case 1:return i=d,m=i.isGenerator,k=i.code,++j,{done:!0,value:{func:m?(l=Function("return "+k)(),n=A(l),n.stream=function(a){var b,c;return b=C.call(arguments,1),c=l.apply(this,D(b)),c.flush?h(c,a):v(c)},n):Function("return "+k)(),isSimple:function(){var a,b,c,d,e;for(b=!0,a=["extends","partial","block"],c=0,d=a.length;d>c;++c)if(e=a[c],-1!==k.indexOf("helpers."+e)||-1!==k.indexOf('helpers["'+e+'"]')){b=!1;break}return b}()}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var i,g,j,e,f,k,l,m,n;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),J=function(){var a;return a={},function(b,c,d){var e,f;return f=z.call(a,b)?a[b]:a[b]={},z.call(f,e=i(c)+"\0"+d.join("\0"))?f[e]:f[e]=function(){var a,e,f,g;return f=A(function(){function a(){h=3}function e(a){for(;;)switch(h){case 0:return++h,{done:!1,value:E(Q.readFile,Q,[b,"utf8"])};case 1:return i=a,++h,{done:!1,value:H(i,c,d)};case 2:return++h,{done:!0,value:a};case 3:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(b){throw a(),b}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:a,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),c.cache?j(f()):(g=A(function(){function a(){f=2}function c(a){for(;;)switch(f){case 0:return++f,{done:!1,value:E(Q.stat,Q,[b])};case 1:return g=a,++f,{done:!0,value:g.mtime.getTime()};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+f)}}function d(b){throw a(),b}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g;return f=0,{close:a,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}}),a=f(),e=g(),A(function(){function b(){i=4}function c(b){for(;;)switch(i){case 0:return k=g(),++i,{done:!1,value:e};case 1:return j=b,++i,{done:!1,value:k};case 2:return j=j!==b,j&&(a=f(),e=k),++i,{done:!1,value:a};case 3:return++i,{done:!0,value:b};case 4:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function d(a){throw b(),a}function h(a){try{return c(a)}catch(b){d(b)}}var h,i,c,d,j,k;return i=0,{close:b,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return d(a),h(void 0)}}}))}()}}(),P=A(function(a,b,c,d){function e(){i=2}function f(e){for(;;)switch(i){case 0:return null==c&&(c={}),k=U(a,b),++i,{done:!1,value:J(k,c,d)()};case 1:return j=e,++i,{done:!0,value:{filepath:k,compiled:j}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function g(a){throw e(),a}function h(a){try{return f(a)}catch(b){g(b)}}var h,i,f,g,j,k;return i=0,{close:e,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return g(a),h(void 0)}}}),_=A(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),i=o(a,l(b)),c||(c=z.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),ab=A(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),b.filename=a,i=p(a,l(b)),c||(c=z.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),O=A(function(a,b){function c(){g=3}function d(c){for(;;)switch(g){case 0:return++g,{done:!1,value:E(Q.readdir,Q,[a])};case 1:return h=c,i=[],++g,{done:!1,value:B(3,+h.length,A(function(c){function d(){k=6}function e(d){for(;;)switch(k){case 0:return m=h[c],l=$.join(a,m),++k,{done:!1,value:E(Q.stat,Q,[l])};case 1:n=d,k=n.isDirectory()?2:4;break;case 2:return j=[],++k,{done:!1,value:O(l,b)};case 3:return j.push.apply(j,D(d)),k=6,{done:!0,value:i.push.apply(i,j)};case 4:k=n.isFile()&&$.extname(m)===b?5:6;break;case 5:return++k,{done:!0,value:i.push(l)};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+k)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var j,g,k,e,f,l,m,n;return k=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}))};case 2:return++g,{done:!0,value:i.sort()};case 3:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h,i;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),K=A(function(a,b,c){function d(){h=5}function e(d){for(;;)switch(h){case 0:return null==c&&(c={}),++h,{done:!1,value:E(Q.stat,Q,[a])};case 1:if(j=d,!j.isDirectory())throw Error("Expected '"+a+"' to be a directory.");return++h,{done:!1,value:O(a,".egs")};case 2:return l=d,++h,{done:!1,value:S(c.prelude)};case 3:return n=d,i=R(m({})),k=function(b,d,e){function f(a){var b;return a instanceof e.Call&&(a.func instanceof e.Func||a.func instanceof e.Binary&&"."===a.func.op&&a.func.left instanceof e.Func&&a.func.right.isConst()&&("call"===(b=a.func.right.constValue())||"apply"===b))}function g(b){return b.pos.file&&!z.call(h,b.pos.file)&&f(b)?(h[b.pos.file]=!0,e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"templates"),e.Const(b.pos,"set")),[e.Const(b.pos,$.relative(a,b.pos.file)),b])):void 0}var h;return h={},b=i(b).walk(g),e.Root(b.pos,e.Call(b.pos,e.Access(b.pos,e.Func(b.pos,null,[e.Ident(b.pos,"factory")],[],e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"module")),"!==",e.Const(b.pos,"undefined")),e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports"))),e.Assign(b.pos,e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Call(b.pos,e.Ident(b.pos,"require"),[e.Const(b.pos,"egs")])])),e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"define")),"===",e.Const(b.pos,"function")),e.Access(b.pos,e.Ident(b.pos,"define"),e.Const(b.pos,"amd"))),e.Call(b.pos,e.Ident(b.pos,"define"),[e.Arr(b.pos,[e.Const(b.pos,"egs-runtime")]),e.Ident(b.pos,"factory")]),e.Assign(b.pos,e.Access(b.pos,e.This(b.pos),e.Const(b.pos,c.globalExport||"EGSTemplates")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Access(b.pos,e.This(b.pos),e.Const(b.pos,"EGSRuntime"))]))))),e.Const(b.pos,"call")),[e.This(b.pos),e.Func(b.pos,null,[e.Ident(b.pos,"EGSRuntime")],["templates"],e.Block(b.pos,[e.IfStatement(b.pos,e.Unary(b.pos,"!",e.Ident(b.pos,"EGSRuntime")),e.Throw(b.pos,e.Call(b.pos,e.Ident(b.pos,"Error"),[e.Const(b.pos,"Expected EGSRuntime to be available")]))),e.Assign(b.pos,e.Ident(b.pos,"templates"),e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"EGSRuntime"),e.Const(b.pos,"Package")),[e.Const(b.pos,"0.2.2")])),b.body,e.Return(b.pos,e.Ident(b.pos,"templates"))]))]),[],[])},++h,{done:!1,value:T.compileFile({input:l,output:b,embedded:!0,embeddedGenerator:!0,noindent:!0,embeddedOpen:c.open,embeddedOpenWrite:c.openWrite,embeddedOpenComment:c.openComment,embeddedOpenLiteral:c.openLiteral,embeddedClose:c.close,embeddedCloseWrite:c.closeWrite,embeddedCloseComment:c.closeComment,embeddedCloseLiteral:c.closeLiteral,coverage:c.coverage,sourceMap:c.sourceMap,undefinedName:c.undefinedName,uglify:c.uglify,encoding:c.encoding,linefeed:c.linefeed,macros:n,astPipe:k})};case 4:return++h,{done:!0,value:d};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i,j,k,l,n;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),Z=A(function(a,b){function c(){g=4}function d(c){for(;;)switch(g){case 0:return null==b&&(b={}),k="egs-package-"+(new Date).getTime()+"-"+Math.random().toString(36).slice(2)+".js",l=$.join(X.tmpdir(),k),++g,{done:!1,value:K(a,l,b)};case 1:return++g,{done:!1,value:E(Q.readFile,Q,[l,"utf8"])};case 2:return h=c,++g,{done:!1,value:E(Q.unlink,Q,[l])};case 3:if(i={EGSRuntime:M},Function(h).call(i),j=i.EGSTemplates,!(j instanceof Y))throw Error("Package did not build successfully");return++g,{done:!0,value:j};case 4:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h,i,j,k,l;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),o.version="0.2.2",o.fromFile=p,o.render=_,o.renderFile=ab,o.renderStream=q,o.renderFileStream=r,o.withEgsPrelude=db,o.compilePackage=K,o.packageFromDirectory=Z,o.Package=Y,o.EGSError=L,o.compile=function(a,b,c){return null==a&&(a=""),null==b&&(b={}),null==c&&(c=[]),I(a,k(b),c)},o.__express=s,o.express=function(a){return null==a&&(a={}),function(b,c,d){null==c&&(c={}),s(b,w(w({},a),c),d)}},d.exports=o}.call(this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),d.exports},c("./egs").withEgsPrelude("macro extends(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE context.extends $name, $new-context\n\nmacro block\n  syntax ident as Identifier, body as GeneratorBody?\n    let name = @const @name(ident)\n    if body?\n      ASTE! write := yield context.block $name, first!(write, (write := '')), #(write)*\n        $body\n        write\n    else\n      ASTE! write := yield context.block $name, first!(write, (write := ''))\n\nmacro partial(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE! write := yield context.partial $name, first!(write, (write := '')), $new-context\n")};"function"==typeof define&&define.amd?define(["require","gorillascript","egs-runtime"],function(a){return b(a)}):"undefined"!=typeof module&&"function"==typeof require?module.exports=b(require):a.EGS=b()}(this);