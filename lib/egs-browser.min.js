!function(a){"use strict";var b=function(b){function c(a){var d=Object.prototype.hasOwnProperty;if(d.call(c._cache,a))return c._cache[a];if(d.call(c,a)){var e=c[a];return delete c[a],c._cache[a]=e.call({})}return b?b(a):void 0}return c._cache={},c["./egs"]=function(){var d={exports:this};return function(e){function f(a){var b;return function(){return a&&(b=a(),a=null),b}}function g(a){var b;return b=/^[^\.]+(\..*)$/.exec(ab.basename(a)),b?b[1]:""}function h(a,b){function c(c,f){var g,h;try{g=a[c](f)}catch(i){return x.rejected(i)}if(g.done)return x.fulfilled(g.value);if(h=a.flush())try{b(h)}catch(i){return x.rejected(i)}return g.value.then(d,e,!0)}function d(a){return c("send",a)}function e(a){return c("throw",a)}return d(void 0)}function i(a){var b,c,d,e,f;for(f=[],b=["open","openWrite","openComment","close","closeWrite","closeComment","cache","prelude"],c=0,d=b.length;d>c;++c)e=b[c],f.push(a[e]||"\0");return f.join("\0")}function j(a){return function(){return a}}function k(a){return null==a&&(a={}),{filename:a.filename,embeddedOpen:a.open,embeddedOpenWrite:a.openWrite,embeddedOpenComment:a.openComment,embeddedClose:a.close,embeddedCloseWrite:a.closeWrite,embeddedCloseComment:a.closeComment,prelude:a.prelude,cache:a.cache,undefinedName:a.undefinedName,uglify:a.uglify}}function l(a){var b,c,d;c=a.maybeSync;for(b in a)D.call(a,b)&&(d=a[b],c[b]=d);return c}function m(a,b){return b&&a?(a(b),""):b}function n(a,b,c){var d,e;return null==c&&(c=!1),e=E(function(e){function f(){j=10}function g(f){for(;;)switch(j){case 0:m=c&&d,j=m?3:1;break;case 1:return++j,{done:!1,value:a()};case 2:m=f,c&&(d=m),++j;case 3:k=b(m.isSimple),l=m.func("",e||{},k),j=l&&l.then?4:6;break;case 4:return++j,{done:!1,value:l};case 5:l=f,++j;case 6:j=k.__extendedBy$?7:9;break;case 7:return++j,{done:!1,value:k.__handleExtends$.maybeSync.call(k,l)};case 8:return j=10,{done:!0,value:f};case 9:return++j,{done:!0,value:l};case 10:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l,m;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e.sync=function(e){var f,g,h,i;return i=c&&d,i||(i=a().sync(),c&&(d=i)),g=b(i.isSimple),f=i.func,h=(f.sync||f)("",e||{},g),"string"!=typeof h&&(h=h.sync()),g.__extendedBy$?g.__handleExtends$.sync.call(g,h):h},e.stream=function(e){var f,g,h,i,j,k;return f=v(),j=f.send,h=f.end,k=f["throw"],i=f["public"],g=z(function(){function f(){k=11}function g(f){for(;;)switch(k){case 0:p=c&&d,k=p?3:1;break;case 1:return++k,{done:!1,value:a()};case 2:p=f,c&&(d=p),++k;case 3:return n=b(p.isSimple),n.__streamSend$=j,++k,{done:!1,value:x.fulfilled()};case 4:m=p.func,o=m.stream?m.stream(j,"",e||{},n):m("",e||{},n),k=o&&o.then?5:7;break;case 5:return++k,{done:!1,value:o};case 6:o=f,++k;case 7:k=n.__extendedBy$?8:10;break;case 8:return l=n.__handleExtends$,++k,{done:!1,value:l.call(n,o)};case 9:return k=11,{done:!0,value:f};case 10:return++k,{done:!0,value:o};case 11:return{done:!0,value:void 0};default:throw Error("Unknown state: "+k)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,k,g,h,l,m,n,o,p;return k=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}()),g.then(function(a){a&&j(a),h()}).then(null,k),i},e.ready=E(function(){function f(){j=6}function g(f){for(;;)switch(j){case 0:j=c?1:5;break;case 1:j=d?4:2;break;case 2:return++j,{done:!1,value:a()};case 3:d=f,++j;case 4:k=d.func,k.sync&&(k=k.sync),d.isSimple&&(l=b(!0),e.sync=function(a){var b;return b=k("",a||{},l),"string"!=typeof b?b.sync():b}),j=6;break;case 5:return++j,{done:!1,value:a()};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e}function o(a){return{filename:a.filename,open:a.open,openWrite:a.openWrite,openComment:a.openComment,close:a.close,closeWrite:a.closeWrite,closeComment:a.closeComment,cache:a.cache,escape:a.escape,partialPrefix:a.partialPrefix,prelude:a.prelude,context:null}}function p(a){var b,c,d;b=D.call(a,"context")?a.context:a,d=["escape","extends","partial","block"];for(c in Y)D.call(Y,c)&&!B(c,d)&&d.push(c);if(b)for(c in b)D.call(b,c)&&!B(c,d)&&d.push(c);return d.sort()}function q(a,b){var c;return null==b&&(b={context:null}),c=p(b),n(j(M(a,k(b),c)),$(b,c),!0)}function r(a,b){var c;return null==b&&(b={context:null}),b.filename=a,c=p(b),n(O(a,k(b),c),$(b,c),b.cache)}function s(a,b,c){var d;return null==b&&(b={context:null}),d=q(a,o(b)),c||(c=D.call(b,"context")?b.context:b),d.stream(c)}function t(a,b,c){var d;return null==b&&(b={context:null}),b.filename=a,d=r(a,o(b)),c||(c=D.call(b,"context")?b.context:b),d.stream(c)}function u(a,b,c){null==b&&(b={context:null}),y(cb(a,b))(c)}function v(){function a(a,c){var d;b&&(d=b[a],b=null,d&&db(d,c))}var b;return b={},{send:function(a){var c;b&&(c=b.data,c&&c(a))},"throw":function(b){a("error",b)},end:function(){a("end")},"public":{on:function(a,c){return b&&(b[a]=c),this}}}}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb;L=this,w="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},x=function(){function a(){function b(a,b){var f;c&&(f=c,c=null,d=a,e=b,f.length&&db(function(){var a,b;for(b=0,a=f.length;a>b;++b)f[b]()}))}var c,d,e;return d=!1,e=null,c=[],{promise:{then:function(b,f,g){function h(){var a,c;try{a=d?f:b,"function"==typeof a?(c=a(e),c&&"function"==typeof c.then?c.then(j,l,g):j(c)):(d?l:j)(e)}catch(h){l(h)}}var i,j,k,l;return g!==!0&&(g=void 0),i=a(),k=i.promise,j=i.fulfill,l=i.reject,c?c.push(h):g?h():db(h),k},sync:function(){var a,b;switch(b=0,a=0,this.then(function(c){return b=1,a=c},function(c){return b=2,a=c},!0),b){case 0:throw Error("Promise did not execute synchronously");case 1:return a;case 2:throw a;default:throw Error("Unknown state")}}},fulfill:function(a){b(!1,a)},reject:function(a){b(!0,a)}}}return a.fulfilled=function(b){var c;return c=a(),c.fulfill(b),c.promise},a.rejected=function(b){var c;return c=a(),c.reject(b),c.promise},a}(),y=function(a){if("object"!=typeof a||null===a)throw TypeError("Expected promise to be an Object, got "+J(a));if("function"!=typeof a.then)throw TypeError("Expected promise.then to be a Function, got "+J(a.then));return function(b){a.then(function(a){return db(b,null,a)},function(a){return db(b,a)})}},z=function(a,b){function c(c,f){var g;try{g=a[c](f)}catch(h){return x.rejected(h)}return g.done?x.fulfilled(g.value):g.value.then(d,e,b)}function d(a){return c("send",a)}function e(a){return c("throw",a)}if("object"!=typeof a||null===a)throw TypeError("Expected generator to be an Object, got "+J(a));if("function"!=typeof a.send)throw TypeError("Expected generator.send to be a Function, got "+J(a.send));if("function"!=typeof a["throw"])throw TypeError("Expected generator.throw to be a Function, got "+J(a["throw"]));if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+J(b));return d(void 0)},A=function(a,b){var c;for(c in b)D.call(b,c)&&(a[c]=b[c]);return a},B="function"==typeof Array.prototype.indexOf?function(){var a;return a=Array.prototype.indexOf,function(b,c){return-1!==a.call(c,b)}}():function(a,b){var c,d;for(d=+b.length,c=-1;++c<d;)if(a===b[c]&&c in b)return!0;return!1},C="function"==typeof Array.isArray?Array.isArray:function(){var a;return a=Object.prototype.toString,function(b){return"[object Array]"===a.call(b)}}(),D=Object.prototype.hasOwnProperty,E=function(a,b){var c;if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+J(b));return"function"==typeof a?(c=function(){return z(a.apply(this,arguments))},c.sync=function(){return z(a.apply(this,arguments),!0).sync()},c.maybeSync=function(){return z(a.apply(this,arguments),!0)},c):z(a,b)},F=function(a,b,c){function d(a){return++j,c(a).then(function(b){return i[a]=b,--j,e()},function(a){return g=!0,f.reject(a)})}function e(){for(;!g&&a>j&&b>h;++h)d(h);return!g&&h>=b&&0===j?(g=!0,f.fulfill(i)):void 0}var f,g,h,i,j;if("number"!=typeof a)throw TypeError("Expected limit to be a Number, got "+J(a));if("number"!=typeof b)throw TypeError("Expected length to be a Number, got "+J(b));if("function"!=typeof c)throw TypeError("Expected body to be a Function, got "+J(c));return(1>a||a!==a)&&(a=1/0),i=[],g=!1,j=0,f=x(),h=0,db(e),f.promise},G=Array.prototype.slice,H=function(a){if(null==a)throw TypeError("Expected an object, got "+J(a));if(C(a))return a;if("string"==typeof a)return a.split("");if("number"==typeof a.length)return G.call(a);throw TypeError("Expected an object with a length property, got "+J(a))},I=function(a,b,c){var d;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+J(a));return d=x(),a.apply(b,H(c).concat([function(a,b){null!=a?d.reject(a):d.fulfill(b)}])),d.promise},J=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),db="function"==typeof e.setImmediate?e.setImmediate:"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){var a;return a=process.nextTick,function(b){var c;if("function"!=typeof b)throw TypeError("Expected func to be a Function, got "+J(b));return c=G.call(arguments,1),c.length?a(function(){b.apply(void 0,H(c))}):a(b)}}():function(a){var b;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+J(a));return b=G.call(arguments,1),b.length?setTimeout(function(){a.apply(void 0,H(b))},0):setTimeout(a,0)},T=c("fs"),ab=c("path"),Y=c("./helpers"),fb=c("./utils"),Q=function(a){function b(d){var e,f;return e=this instanceof b?this:w(c),null==d&&(d=""),e.message=d,f=a.call(e,d),"function"==typeof a.captureStackTrace?a.captureStackTrace(e,b):"stack"in f&&(e.stack=f.stack),e}var c,d;return d=a.prototype,c=b.prototype=w(d),c.constructor=b,b.displayName="EgsError","function"==typeof a.extended&&a.extended(b),c.name="EgsError",b}(Error),V=f(function(){var d,e;return e=c("gorillascript"),null!=e?x.fulfilled(e):"function"==typeof define&&define.amd?(d=x(),b(["gorillascript"],function(a){return d.fulfill(a)}),d.promise):"object"==typeof a&&null!==a?a.GorillaScript?x.fulfilled(a.GorillaScript):x.rejected(Error("GorillaScript must be available before EGS requests it")):x.rejected(Error("Unable to detect environment, cannot load GorillaScript"))}),X=function(){var a;return a={},function(b,c){var d,e;return e=D.call(a,c)?a[c]:a[c]={},D.call(e,b)?e[b]:(d=b,ab.extname(d)||(d+=""+g(c)),e[b]=ab.resolve(ab.dirname(c),d))}}(),K=function(){var a,b,c;return b=f(E(function(){function b(){f=6}function c(b){for(;;)switch(f){case 0:i=a,f=i?3:1;break;case 1:return++f,{done:!1,value:I(T.readFile,T,[__dirname+"/../src/egs-prelude.gs","utf8"])};case 2:i=b,++f;case 3:return++f,{done:!1,value:V()};case 4:return g=b,++f,{done:!1,value:g.parse(i)};case 5:return h=b,++f,{done:!0,value:h.macros};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+f)}}function d(a){throw b(),a}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g,h,i;return f=0,{close:b,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}})),c={},[function(a){var d;return null==a&&(a=null),d=b(),a?D.call(c,a)?c[a]:c[a]=z(function(){function b(){g=5}function c(b){for(;;)switch(g){case 0:return++g,{done:!1,value:d};case 1:return h=b,++g,{done:!1,value:I(T.readFile,T,[a,"utf8"])};case 2:return k=b,++g,{done:!1,value:V()};case 3:return i=b,++g,{done:!1,value:i.parse(k,{macros:h})};case 4:return j=b,++g,{done:!0,value:j.macros};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw b(),a}function f(a){try{return c(a)}catch(b){e(b)}}var f,g,c,e,h,i,j,k;return g=0,{close:b,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}()):d},function(b){return a=b,this}]}(),W=K[0],gb=K[1],U=function(){var a;return a=f(E(function(){function a(){e=2}function b(a){for(;;)switch(e){case 0:return++e,{done:!1,value:V()};case 1:return o=a,h=o.AST,q=function(a,b){var c;return a instanceof h.Call?(c=a.func,c instanceof h.Ident&&c.name===b):void 0},r=function(a,b){var c,d,e;return a instanceof h.Call&&(c=a.func,c instanceof h.Binary&&"."===c.op)?(d=c.left,e=c.right,d instanceof h.Ident&&"context"===d.name&&e.isConst()&&e.constValue()===b):!1},l=function(a){var b;if(a instanceof h.Call&&(b=a.func,b instanceof h.Binary&&"."===b.op&&b.left instanceof h.Ident&&"write"===b.left.name&&b.right.isConst()))switch(b.right.constValue()){case"call":return h.Block(a.pos,[a.args[0],h.Call(a.pos,b.left,G.call(a.args,1))]);case"apply":return h.Block(a.pos,[a.args[0],a.args[1].isNoop()?h.Call(a.pos,b.left,[h.IfExpression(a.args[1].pos,h.Access(a.args[1].pos,a.args[1],h.Const(a.args[1],1)),h.Call(a.pos,h.Access(a.pos,h.Ident(a.pos,"context"),h.Const(a.pos,"escape")),[h.Access(a.args[1].pos,a.args[1],h.Const(a.args[1],0))]),h.Access(a.args[1].pos,a.args[1],h.Const(a.args[1],0)))]):h.Call(a.pos,b.left,[h.Call(a.args[1].pos,h.Access(a.pos,h.Ident(a.pos,"context"),h.Const(a.args[1].pos,"__maybeEscape")),[h.Access(a.pos,h.Ident(a.pos,"context"),h.Const(a.pos,"escape")),a.args[1]])])]);default:return}},n=function(a){return q(a,"write")&&2===a.args.length&&a.args[1].isConst()&&a.args[1].constValue()?h.Call(a.pos,a.func,[h.Call(a.pos,h.Access(a.pos,h.Ident(a.pos,"context"),h.Const(a.pos,"escape")),[a.args[0]])]):void 0},x=function(a){var b;return r(a,"escape")&&1===a.args.length&&(b=a.args[0],b&&(r(b,"h")||r(b,"html"))&&1===b.args.length)?b.args[0]:void 0},i=function(a){var b;return a.isConst()?"string"!=typeof a.constValue():a instanceof h.Binary?"+"===a.op?i(a.left)&&i(a.right):!0:a instanceof h.IfExpression?i(a.whenTrue)||i(a.whenFalse):a instanceof h.BlockExpression||a instanceof h.BlockStatement?i((b=a.body)[b.length-1]):!r(a,"escape")},s=function(a){var b,c,d,e,f,g,j,k,l,m,n;if(a instanceof h.BlockExpression||a instanceof h.BlockStatement){for(d=a.body.slice(),e=!1,b=H(d),f=0,c=b.length;c>f;++f)l=b[f],j=l.walkWithThis(s),d[f]=j,j!==l&&(e=!0);for(f=0;f<d.length-1;)g=d[f],k=d[f+1],q(g,"write")&&1===g.args.length&&q(k,"write")&&1===k.args.length?(e=!0,d.splice(f,2,h.Call(g.pos,g.func,[h.Binary(g.pos,i(g.args[0])&&i(k.args[0])?h.Binary(g.pos,h.Const(g.pos,""),"+",g.args[0]):g.args[0],"+",k.args[0])]))):++f;if(e)return h.Block(a.pos,d,a.label)}else if((a instanceof h.IfStatement||a instanceof h.IfExpression)&&!a.label&&(n=a.whenTrue.walkWithThis(s),m=a.whenFalse.walkWithThis(s),q(n,"write")&&(q(m,"write")||m.isNoop())))return h.Call(a.pos,n.func,[h.IfExpression(a.pos,a.test.walkWithThis(s),n.args[0],m.isNoop()?h.Const(m.pos,""):m.args[0])])},p=function(a){var b;b={};try{a.walk(function(a){if(a instanceof h.Func)return a;if(r(a,"extends"))throw b})}catch(c){if(c===b)return!0;throw c}return!1},w=function(a){return a instanceof h.Func?a:q(a,"write")?h.Noop(a.pos):void 0},v=function(a){return a instanceof h.Func&&p(a)?a.walk(w):void 0},m=function(a){return q(a,"write")?h.Binary(a.pos,a.func,"+=",a.args[0]).walk(m):void 0},t=function(a,b){return b instanceof h.Binary&&"+"===b.op?h.Binary(a.pos,t(a,b.left),"+",b.right):h.Binary(a.pos,a,"+",b)},k=function(a){var b,c,d;return a instanceof h.BlockStatement&&(d=(b=a.body)[b.length-1],d instanceof h.Return&&d.node instanceof h.Ident&&"write"===d.node.name&&(c=(b=a.body)[b.length-2],c&&c instanceof h.Binary&&"+="===c.op&&c.left instanceof h.Ident&&"write"===c.left.name))?h.BlockStatement(a.pos,H(G.call(a.body,0,-2)).concat([h.Return(c.pos,t(c.left,c.right))]),a.label):void 0},u=function(a){return a instanceof h.Binary&&"=="===a.op&&a.left instanceof h.Ident&&"context"===a.left.name&&a.right.isConst()&&null==a.right.constValue()?h.Const(a.pos,!1):void 0},j=function(a){return function(b){return b instanceof h.Binary&&"."===b.op&&b.left instanceof h.Ident&&"context"===b.left.name&&b.right.isConst()&&B(b.right.constValue(),a)?h.Binary(b.pos,h.Ident(b.left.pos,"helpers"),".",b.right):void 0}},g=function(a){return a instanceof h.Func&&2===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name?h.Func(a.pos,a.name,[a.params[0],a.params[1],h.Ident(a.pos,"helpers")],a.variables,a.body,a.declarations):void 0},f=function(a){var b,c,d;return a instanceof h.Func&&3===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name&&"helpers"===a.params[2].name&&a.body instanceof h.BlockStatement&&(c=(b=a.body.body)[b.length-1],c instanceof h.Return&&c.node instanceof h.Obj)?(d=c.pos,h.Func(a.pos,a.name,a.params,a.variables,h.BlockStatement(a.body.pos,H(G.call(a.body.body,0,-1)).concat([h.Return(d,h.Obj(c.node.pos,H(c.node.elements).concat([h.Obj.Pair(d,"flush",h.Func(d,null,[],["flushed"],h.Block(d,[h.Assign(d,h.Ident(d,"flushed"),h.Ident(d,"write")),h.Assign(d,h.Ident(d,"write"),h.Const(d,"")),h.Return(d,h.Ident(d,"flushed"))])))])))])),a.declarations)):void 0},++e,{done:!0,value:function(a){return function(b){return b.walk(l).walk(n).walk(x).walk(s).walk(v).walk(m).walk(k).walk(u).walk(j(a)).walk(g).walk(f)}}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+e)}}function c(b){throw a(),b}function d(a){try{return b(a)}catch(d){c(d)}}var d,e,b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return e=0,{close:a,iterator:function(){return this},next:function(){return d(void 0)},send:d,"throw":function(a){return c(a),d(void 0)}}})),E(function(b){function c(){g=2}function d(c){for(;;)switch(g){case 0:return++g,{done:!1,value:a()};case 1:return h=c,++g,{done:!0,value:h(b)};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}})}(),N=E(function(a,b,c){function d(){j=9}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:W(b.prelude)};case 1:return p=d,++j,{done:!1,value:U(c)};case 2:return l=d,i=A({},b),i.embedded=!0,i.noindent=!0,i.macros=p,i.prelude=null,i.astPipe=l,q=i,o=!1,++j,{done:!1,value:V()};case 3:n=d,++j;case 4:return++j,{done:!1,value:n.compile(a,q)};case 5:k=d,m=k.code,j=8;break;case 6:return q.embeddedGenerator=!0,o=!0,++j,{done:!1,value:n.compile(a,q)};case 7:k=d,m=k.code,++j;case 8:return++j,{done:!0,value:{isGenerator:o,code:m}};case 9:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){if(4!==j&&5!==j)throw d(),a;h=a,j=6}function g(a){for(;;)try{return e(a)}catch(b){f(b)}}var h,i,g,j,e,f,k,l,m,n,o,p,q;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),M=E(function(a,b,c){function d(){j=2}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:N(a,b,c)};case 1:return i=d,m=i.isGenerator,k=i.code,++j,{done:!0,value:{func:m?(l=Function("return "+k)(),n=E(l),n.stream=function(a){var b,c;return b=G.call(arguments,1),c=l.apply(this,H(b)),c.flush?h(c,a):z(c)},n):Function("return "+k)(),isSimple:function(){var a,b,c,d,e;for(b=!0,a=["extends","partial","block"],c=0,d=a.length;d>c;++c)if(e=a[c],-1!==k.indexOf("helpers."+e)||-1!==k.indexOf('helpers["'+e+'"]')){b=!1;break}return b}()}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var i,g,j,e,f,k,l,m,n;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),O=function(){var a;return a={},function(b,c,d){var e,f;return f=D.call(a,b)?a[b]:a[b]={},D.call(f,e=i(c)+"\0"+d.join("\0"))?f[e]:f[e]=function(){var a,e,f,g;return f=E(function(){function a(){h=3}function e(a){for(;;)switch(h){case 0:return++h,{done:!1,value:I(T.readFile,T,[b,"utf8"])};case 1:return i=a,++h,{done:!1,value:M(i,c,d)};case 2:return++h,{done:!0,value:a};case 3:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(b){throw a(),b}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:a,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),c.cache?j(f()):(g=E(function(){function a(){f=2}function c(a){for(;;)switch(f){case 0:return++f,{done:!1,value:I(T.stat,T,[b])};case 1:return g=a,++f,{done:!0,value:g.mtime.getTime()};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+f)}}function d(b){throw a(),b}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g;return f=0,{close:a,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}}),a=f(),e=g(),E(function(){function b(){i=4}function c(b){for(;;)switch(i){case 0:return k=g(),++i,{done:!1,value:e};case 1:return j=b,++i,{done:!1,value:k};case 2:return j=j!==b,j&&(a=f(),e=k),++i,{done:!1,value:a};case 3:return++i,{done:!0,value:b};case 4:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function d(a){throw b(),a}function h(a){try{return c(a)}catch(b){d(b)}}var h,i,c,d,j,k;return i=0,{close:b,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return d(a),h(void 0)}}}))}()}}(),S=E(function(a,b,c,d){function e(){i=2}function f(e){for(;;)switch(i){case 0:return null==c&&(c={}),k=X(a,b),++i,{done:!1,value:O(k,c,d)()};case 1:return j=e,++i,{done:!0,value:{filepath:k,compiled:j}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function g(a){throw e(),a}function h(a){try{return f(a)}catch(b){g(b)}}var h,i,f,g,j,k;return i=0,{close:e,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return g(a),h(void 0)}}}),eb=A({},Y),K=A({},Y),K["extends"]=function(a,b){if(!this.__currentFilepath$)throw Q("Can only use extends if the 'filename' option is specified");if(this.__inPartial$)throw Q("Cannot use extends when in a partial");if(this.__extendedBy$)throw Q("Cannot use extends more than once");this.__extendedBy$=this.__fetchCompiled$(a),this.__extendedByLocals$=b},K.partial=l(E(function(a,b,c){function d(){j=5}function e(d){for(;;)switch(j){case 0:if(null==c&&(c={}),!k.__currentFilepath$)throw Q("Can only use partial if the 'filename' option is specified");return a=ab.join(ab.dirname(a),""+k.__partialPrefix$+ab.basename(a)),b=m(k.__streamSend$,b),++j,{done:!1,value:k.__fetchCompiled$(a)};case 1:i=d,l=i.filepath,n=i.compiled.func,h=w(k),h.__currentFilepath$=l,h.__inPartial$=!0,o=h,j=n.maybeSync?2:4;break;case 2:return++j,{done:!1,value:n.maybeSync(b,c,o)};case 3:return j=5,{done:!0,value:d};case 4:return++j,{done:!0,value:n(b,c,o)};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var h,i,g,j,e,k,f,l,n,o;return k=this,j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}})),K.block=l(E(function(a,b,c){function d(){h=6}function e(d){for(;;)switch(h){case 0:if(null==c&&(c=null),i.__inPartial$)throw Q("Cannot use block when in a partial");b=m(i.__streamSend$,b),k=i.__blocks$,n=i.__helpers$,h=i.__extendedBy$&&!n.__inBlock$?1:2;break;case 1:return null==c||D.call(k,a)||(k[a]=c),h=6,{done:!0,value:b};case 2:j=D.call(k,a)&&k[a]||c,l=b,h=j?3:5;break;case 3:return n.__inBlock$=!0,++h,{done:!1,value:E(j(b),!0)};case 4:l=d,n.__inBlock$=!1,++h;case 5:return++h,{done:!0,value:l};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,i,f,j,k,l,n;return i=this,h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}})),K.__handleExtends$=l(E(function(){function a(){g=9}function b(a){for(;;)switch(g){case 0:return++g,{done:!1,value:h.__extendedBy$};case 1:f=a,i=f.filepath,j=f.compiled.func,e=w(h),e.__currentFilepath$=i,e.__extendedBy$=null,e.__extendedByLocals$=null,l=e,k=h.__extendedByLocals$||{},g=j.maybeSync?2:4;break;case 2:return++g,{done:!1,value:j.maybeSync("",k,l)};case 3:m=a,g=5;break;case 4:m=j("",k,l),++g;case 5:g=l.__extendedBy$?6:8;break;case 6:return++g,{done:!1,value:l.__handleExtends$.call(l,m)};case 7:return g=9,{done:!0,value:a};case 8:return++g,{done:!0,value:m};case 9:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function c(b){throw a(),b}function d(a){try{return b(a)}catch(d){c(d)}}var e,f,d,g,b,h,c,i,j,k,l,m;return h=this,g=0,{close:a,iterator:function(){return this},next:function(){return d(void 0)},send:d,"throw":function(a){return c(a),d(void 0)}}})),Z=K,$=function(){function a(a,b,c,d,e){var f,g;return f=w(Z),f.__currentFilepath$=b,f.__partialPrefix$=a,f.__fetchCompiled$=c,f.__extendedBy$=null,f.__extendedByLocals$=null,f.__inPartial$=!1,f.__inBlock$=!1,f.escape=d,g=w(eb),g.__currentFilepath$=b,g.escape=d,e&&(A(g,e),A(f,e)),function(a){var b;return a?g:(b=w(f),b.__helpers$=b,b.__blocks$={},b)}}return function(b,c){return a("string"==typeof b.partialPrefix?b.partialPrefix:"_",b.filename,function(){var a,d;return d=b.__inPackage$,d?function(a){return d._find(a,this.__currentFilepath$)}:(a=k(b),function(b){return S(b,this.__currentFilepath$,a,c)})}(),"function"==typeof b.escape?b.escape:fb.escapeHTML,D.call(b,"context")?b.context:b)}}(),bb=E(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),i=q(a,o(b)),c||(c=D.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),cb=E(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),b.filename=a,i=r(a,o(b)),c||(c=D.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),R=E(function(a,b){function c(){g=3}function d(c){for(;;)switch(g){case 0:return++g,{done:!1,value:I(T.readdir,T,[a])};case 1:return h=c,i=[],++g,{done:!1,value:F(3,+h.length,E(function(c){function d(){k=6}function e(d){for(;;)switch(k){case 0:return m=h[c],l=ab.join(a,m),++k,{done:!1,value:I(T.stat,T,[l])};case 1:n=d,k=n.isDirectory()?2:4;break;case 2:return j=[],++k,{done:!1,value:R(l,b)};case 3:return j.push.apply(j,H(d)),k=6,{done:!0,value:i.push.apply(i,j)};case 4:k=n.isFile()&&ab.extname(m)===b?5:6;break;case 5:return++k,{done:!0,value:i.push(l)};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+k)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var j,g,k,e,f,l,m,n;return k=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}))};case 2:return++g,{done:!0,value:i.sort()};case 3:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h,i;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),P=E(function(a,b,c){function d(){h=7}function e(d){for(;;)switch(h){case 0:return null==c&&(c={}),++h,{done:!1,value:I(T.stat,T,[a])};case 1:if(j=d,!j.isDirectory())throw Error("Expected '"+a+"' to be a directory.");return++h,{done:!1,value:R(a,".egs")};case 2:return m=d,++h,{done:!1,value:V()};case 3:return l=d,++h,{done:!1,value:W(c.prelude)};case 4:return n=d,++h,{done:!1,value:U(p({}))};case 5:return i=d,k=function(b,d,e){function f(a){var b;return a instanceof e.Call&&(a.func instanceof e.Func||a.func instanceof e.Binary&&"."===a.func.op&&a.func.left instanceof e.Func&&a.func.right.isConst()&&("call"===(b=a.func.right.constValue())||"apply"===b))}function g(b){return b.pos.file&&!D.call(h,b.pos.file)&&f(b)?(h[b.pos.file]=!0,e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"templates"),e.Const(b.pos,"set")),[e.Const(b.pos,ab.relative(a,b.pos.file)),b])):void 0}var h;return h={},b=i(b).walk(g),e.Root(b.pos,e.Call(b.pos,e.Access(b.pos,e.Func(b.pos,null,[e.Ident(b.pos,"factory")],[],e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"module")),"!==",e.Const(b.pos,"undefined")),e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports"))),e.Assign(b.pos,e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Call(b.pos,e.Ident(b.pos,"require"),[e.Const(b.pos,"egs")])])),e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"define")),"===",e.Const(b.pos,"function")),e.Access(b.pos,e.Ident(b.pos,"define"),e.Const(b.pos,"amd"))),e.Call(b.pos,e.Ident(b.pos,"define"),[e.Arr(b.pos,[e.Const(b.pos,"egs")]),e.Ident(b.pos,"factory")]),e.Assign(b.pos,e.Access(b.pos,e.This(b.pos),e.Const(b.pos,c.globalExport||"EGSTemplates")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Access(b.pos,e.This(b.pos),e.Const(b.pos,"EGS"))]))))),e.Const(b.pos,"call")),[e.This(b.pos),e.Func(b.pos,null,[e.Ident(b.pos,"EGS")],["templates"],e.Block(b.pos,[e.IfStatement(b.pos,e.Unary(b.pos,"!",e.Ident(b.pos,"EGS")),e.Throw(b.pos,e.Call(b.pos,e.Ident(b.pos,"Error"),[e.Const(b.pos,"Expected EGS to be available")]))),e.Assign(b.pos,e.Ident(b.pos,"templates"),e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"EGS"),e.Const(b.pos,"Package")),[])),b.body,e.Return(b.pos,e.Ident(b.pos,"templates"))]))]),[],[])},++h,{done:!1,value:l.compileFile({input:m,output:b,embedded:!0,embeddedGenerator:!0,noindent:!0,embeddedOpen:c.open,embeddedOpenWrite:c.openWrite,embeddedOpenComment:c.openComment,embeddedClose:c.close,embeddedCloseWrite:c.closeWrite,embeddedCloseComment:c.closeComment,coverage:c.coverage,sourceMap:c.sourceMap,undefinedName:c.undefinedName,uglify:c.uglify,encoding:c.encoding,linefeed:c.linefeed,macros:n,astPipe:k})};case 6:return++h,{done:!0,value:d};case 7:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i,j,k,l,m,n;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),_=function(){function a(b){var d;return d=this instanceof a?this:w(c),null==b&&(b={}),d.options=b,d.factories={},d.templates={},d}function b(a){return 47!==a.charCodeAt(0)?"/"+a:a}var c;return c=a.prototype,a.displayName="Package",c.set=function(a,c,d){var e;return null==d&&(d={}),a=b(a),e=this.factories[a]=E(c),this.templates[a]=n(j(x.fulfilled({func:e,isSimple:!1})),$(A(A({__inPackage$:this,filename:a},this.options),d)),!0),this},c.get=function(a){var c;if(a=b(a),c=this.templates,D.call(c,a))return c[a];throw Q("Unknown filepath: '"+a+"'")},c.render=E(function(a,b){function c(){g=2}function d(c){for(;;)switch(g){case 0:return null==b&&(b={}),i=h.get(a),++g,{done:!1,value:i(b)};case 1:return++g,{done:!0,value:c};
case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,h,e,i;return h=this,g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),c.renderSync=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.sync(b)},c.renderStream=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.stream(b)},c._find=function(a,b){var c,d;return d=X(a,b),c=this.factories,D.call(c,d)?x.fulfilled({filepath:d,compiled:{func:c[d],isSimple:!1}}):x.rejected(Q("Cannot find '"+a+"' from '"+d+"', tried '"+d+"'"))},c.express=function(){var a;return a=this,function(b,c,d){y(a.render(b,c))(d)}},a}(),q.version="0.1.9",q.fromFile=r,q.render=bb,q.renderFile=cb,q.renderStream=s,q.renderFileStream=t,q.withEgsPrelude=gb,q.compilePackage=P,q.Package=_,q.EgsError=Q,q.compile=function(a,b,c){return null==a&&(a=""),null==b&&(b={}),null==c&&(c=[]),N(a,k(b),c)},q.__express=u,q.express=function(a){return null==a&&(a={}),function(b,c,d){null==c&&(c={}),u(b,A(A({},a),c),d)}},d.exports=q}.call(this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),d.exports},c["./helpers"]=function(){var a={exports:this},b=this;return function(){var a,c,d,e;a="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},c="function"==typeof Array.isArray?Array.isArray:function(){var a;return a=Object.prototype.toString,function(b){return"[object Array]"===a.call(b)}}(),d=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),e=function(){function b(d){var e;return e=this instanceof b?this:a(c),e.text=d,e}var c;return c=b.prototype,b.displayName="RawHTML",c.toHTML=function(){return this.text},b}(),b.h=b.html=function(a){return e(String(a))},b.j=b.javascript=function(){function a(a){return b[a]}var b,c;return b={"\\":"\\\\","\r":"\\r","\u2028":"\\u2028","\u2029":"\\u2029","\n":"\\n","\f":"\\f","'":"\\'",'"':'\\"',"	":"\\t"},c=/[\\\r\u2028\u2029\n\f'"\t]/g,function(b){return e(String(b).replace(c,a))}}(),b.__maybeEscape=function(a,b){if("function"!=typeof a)throw TypeError("Expected escape to be a Function, got "+d(a));if(!c(b))throw TypeError("Expected arr to be an Array, got "+d(b));return b[1]?a(b[0]):b[0]}}.call(this),a.exports},c["./utils"]=function(){var a={exports:this},b=this;return function(){var a;a=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),b.escapeHTML=function(){function b(a){return d[a]}function c(a){return a.replace(e,b)}var d,e;return d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},e=/[&<>"']/g,function(b){if("string"==typeof b)return c(b);if("number"==typeof b)return b.toString();if(null!=b&&"function"==typeof b.toHTML)return String(b.toHTML());throw TypeError("Expected a String, Number, or Object with a toHTML method, got "+a(b))}}()}.call(this),a.exports},c("./egs").withEgsPrelude("macro extends(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE context.extends $name, $new-context\n\nmacro block\n  syntax ident as Identifier, body as GeneratorBody?\n    let name = @const @name(ident)\n    if body?\n      ASTE! write := yield context.block $name, first!(write, (write := '')), #(write)*\n        $body\n        write\n    else\n      ASTE! write := yield context.block $name, first!(write, (write := ''))\n\nmacro partial(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE! write := yield context.partial $name, first!(write, (write := '')), $new-context\n")};"function"==typeof define&&define.amd?define(function(a){return b(a)}):"undefined"!=typeof module&&"function"==typeof require?module.exports=b(require):a.EGS=b()}(this);