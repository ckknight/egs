!function(a){"use strict";var b=function(b){function c(a){var d=Object.prototype.hasOwnProperty;if(d.call(c._cache,a))return c._cache[a];if(d.call(c,a)){var e=c[a];return delete c[a],c._cache[a]=e.call({})}return b?b(a):void 0}return c._cache={},c["./egs"]=function(){var d={exports:this};return function(e){function f(a){var b;return function(){return a&&(b=a(),a=null),b}}function g(a){var b;return b=/^[^\.]+(\..*)$/.exec(X.basename(a)),b?b[1]:""}function h(a){var b,c,d,e,f;for(f=[],b=["open","openWrite","openComment","close","closeWrite","closeComment","cache","prelude"],c=0,d=b.length;d>c;++c)e=b[c],f.push(a[e]||"\0");return f.join("\0")}function i(a){return function(){return a}}function j(a){return null==a&&(a={}),{filename:a.filename,embeddedOpen:a.open,embeddedOpenWrite:a.openWrite,embeddedOpenComment:a.openComment,embeddedClose:a.close,embeddedCloseWrite:a.closeWrite,embeddedCloseComment:a.closeComment,prelude:a.prelude,cache:a.cache}}function k(a){var b,c,d;c=a.maybeSync;for(b in a)y.call(a,b)&&(d=a[b],c[b]=d);return c}function l(a,b,c){var d,e;return null==c&&(c=!1),e=z(function(e){function f(){j=10}function g(f){for(;;)switch(j){case 0:n=c&&d,j=n?3:1;break;case 1:return++j,{done:!1,value:a()};case 2:n=f,c&&(d=n),++j;case 3:l=b(n.isSimple),m=n.func("",e||{},l),j=m&&m.then?4:6;break;case 4:return++j,{done:!1,value:m};case 5:m=f,++j;case 6:j=l.__extendedBy$?7:9;break;case 7:return k=l.__handleExtends$,++j,{done:!1,value:k.maybeSync.call(l,m)};case 8:return j=10,{done:!0,value:f};case 9:return++j,{done:!0,value:m};case 10:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l,m,n;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e.sync=function(e){var f,g,h,i;return i=c&&d,i||(i=a().sync(),c&&(d=i)),g=b(i.isSimple),f=i.func,h=(f.sync||f)("",e||{},g),"string"!=typeof h&&(h=h.sync()),g.__extendedBy$?g.__handleExtends$.sync.call(g,h):h},e.ready=z(function(){function f(){j=6}function g(f){for(;;)switch(j){case 0:j=c?1:5;break;case 1:j=d?4:2;break;case 2:return++j,{done:!1,value:a()};case 3:d=f,++j;case 4:k=d.func,k.sync&&(k=k.sync),d.isSimple&&(l=b(!0),e.sync=function(a){var b;return b=k("",a||{},l),"string"!=typeof b?b.sync():b}),j=6;break;case 5:return++j,{done:!1,value:a()};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function h(a){throw f(),a}function i(a){try{return g(a)}catch(b){h(b)}}var i,j,g,h,k,l;return j=0,{close:f,iterator:function(){return this},next:function(){return i(void 0)},send:i,"throw":function(a){return h(a),i(void 0)}}}),e}function m(a){return{filename:a.filename,open:a.open,openWrite:a.openWrite,openComment:a.openComment,close:a.close,closeWrite:a.closeWrite,closeComment:a.closeComment,cache:a.cache,escape:a.escape,partialPrefix:a.partialPrefix,prelude:a.prelude,context:null}}function n(a){var b,c,d;b=y.call(a,"context")?a.context:a,d=["escape","extends","partial","block"];for(c in T)y.call(T,c)&&!w(c,d)&&d.push(c);if(b)for(c in b)y.call(b,c)&&!w(c,d)&&d.push(c);return d.sort()}function o(a,b){var c;return null==b&&(b={context:null}),c=n(b),l(i(H(a,j(b),c)),V(b,c),!0)}function p(a,b){var c;return null==b&&(b={context:null}),b.filename=a,c=n(b),l(J(a,j(b),c),V(b,c),b.cache)}function q(a,b,c){null==b&&(b={context:null}),t(Z(a,b))(c)}var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb;G=this,r="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},s=function(){function a(){function b(a,b){var f;c&&(f=c,c=null,d=a,e=b,f.length&&$(function(){var a,b;for(b=0,a=f.length;a>b;++b)f[b]()}))}var c,d,e;return d=!1,e=null,c=[],{promise:{then:function(b,f,g){function h(){var a,c;try{a=d?f:b,"function"==typeof a?(c=a(e),c&&"function"==typeof c.then?c.then(j,l,g):j(c)):(d?l:j)(e)}catch(h){l(h)}}var i,j,k,l;return g!==!0&&(g=void 0),i=a(),k=i.promise,j=i.fulfill,l=i.reject,c?c.push(h):g?h():$(h),k},sync:function(){var a,b;switch(b=0,a=0,this.then(function(c){return b=1,a=c},function(c){return b=2,a=c},!0),b){case 0:throw Error("Promise did not execute synchronously");case 1:return a;case 2:throw a;default:throw Error("Unknown state")}}},fulfill:function(a){b(!1,a)},reject:function(a){b(!0,a)}}}return a.fulfilled=function(b){var c;return c=a(),c.fulfill(b),c.promise},a.rejected=function(b){var c;return c=a(),c.reject(b),c.promise},a}(),t=function(a){if("object"!=typeof a||null===a)throw TypeError("Expected promise to be an Object, got "+E(a));if("function"!=typeof a.then)throw TypeError("Expected promise.then to be a Function, got "+E(a.then));return function(b){a.then(function(a){return $(b,null,a)},function(a){return $(b,a)})}},u=function(a,b){function c(c,f){var g;try{g=a[c](f)}catch(h){return s.rejected(h)}return g.done?s.fulfilled(g.value):g.value.then(d,e,b)}function d(a){return c("send",a)}function e(a){return c("throw",a)}if("object"!=typeof a||null===a)throw TypeError("Expected generator to be an Object, got "+E(a));if("function"!=typeof a.send)throw TypeError("Expected generator.send to be a Function, got "+E(a.send));if("function"!=typeof a["throw"])throw TypeError("Expected generator.throw to be a Function, got "+E(a["throw"]));if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+E(b));return d(void 0)},v=function(a,b){var c;for(c in b)y.call(b,c)&&(a[c]=b[c]);return a},w="function"==typeof Array.prototype.indexOf?function(){var a;return a=Array.prototype.indexOf,function(b,c){return-1!==a.call(c,b)}}():function(a,b){var c,d;for(d=+b.length,c=-1;++c<d;)if(a===b[c]&&c in b)return!0;return!1},x="function"==typeof Array.isArray?Array.isArray:function(){var a;return a=Object.prototype.toString,function(b){return"[object Array]"===a.call(b)}}(),y=Object.prototype.hasOwnProperty,z=function(a,b){var c;if(null==b)b=!1;else if("boolean"!=typeof b)throw TypeError("Expected allowSync to be a Boolean, got "+E(b));return"function"==typeof a?(c=function(){return u(a.apply(this,arguments))},c.sync=function(){return u(a.apply(this,arguments),!0).sync()},c.maybeSync=function(){return u(a.apply(this,arguments),!0)},c):u(a,b)},A=function(a,b,c){function d(a){return++j,c(a).then(function(b){return i[a]=b,--j,e()},function(a){return g=!0,f.reject(a)})}function e(){for(;!g&&a>j&&b>h;++h)d(h);return!g&&h>=b&&0===j?(g=!0,f.fulfill(i)):void 0}var f,g,h,i,j;if("number"!=typeof a)throw TypeError("Expected limit to be a Number, got "+E(a));if("number"!=typeof b)throw TypeError("Expected length to be a Number, got "+E(b));if("function"!=typeof c)throw TypeError("Expected body to be a Function, got "+E(c));return(1>a||a!==a)&&(a=1/0),i=[],g=!1,j=0,f=s(),h=0,$(e),f.promise},B=Array.prototype.slice,C=function(a){if(null==a)throw TypeError("Expected an object, got "+E(a));if(x(a))return a;if("string"==typeof a)return a.split("");if("number"==typeof a.length)return B.call(a);throw TypeError("Expected an object with a length property, got "+E(a))},D=function(a,b,c){var d;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+E(a));return d=s(),a.apply(b,C(c).concat([function(a,b){null!=a?d.reject(a):d.fulfill(b)}])),d.promise},E=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),$="function"==typeof e.setImmediate?e.setImmediate:"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){var a;return a=process.nextTick,function(b){var c;if("function"!=typeof b)throw TypeError("Expected func to be a Function, got "+E(b));return c=B.call(arguments,1),c.length?a(function(){b.apply(void 0,C(c))}):a(b)}}():function(a){var b;if("function"!=typeof a)throw TypeError("Expected func to be a Function, got "+E(a));return b=B.call(arguments,1),b.length?setTimeout(function(){a.apply(void 0,C(b))},0):setTimeout(a,0)},O=c("fs"),X=c("path"),T=c("./helpers"),ab=c("./utils"),L=function(a){function b(d){var e,f;return e=this instanceof b?this:r(c),null==d&&(d=""),e.message=d,f=a.call(e,d),"function"==typeof a.captureStackTrace?a.captureStackTrace(e,b):"stack"in f&&(e.stack=f.stack),e}var c,d;return d=a.prototype,c=b.prototype=r(d),c.constructor=b,b.displayName="EgsError","function"==typeof a.extended&&a.extended(b),c.name="EgsError",b}(Error),Q=f(function(){var d,e;return e=c("gorillascript"),null!=e?s.fulfilled(e):"function"==typeof define&&define.amd?(d=s(),b(["gorillascript"],function(a){return d.fulfill(a)}),d.promise):"object"==typeof a&&null!==a?a.GorillaScript?s.fulfilled(a.GorillaScript):s.rejected(Error("GorillaScript must be available before EGS requests it")):s.rejected(Error("Unable to detect environment, cannot load GorillaScript"))}),S=function(){var a;return a={},function(b,c){var d,e;return e=y.call(a,c)?a[c]:a[c]={},y.call(e,b)?e[b]:(d=b,X.extname(d)||(d+=""+g(c)),e[b]=X.resolve(X.dirname(c),d))}}(),F=function(){var a,b,c;return b=f(z(function(){function b(){f=6}function c(b){for(;;)switch(f){case 0:i=a,f=i?3:1;break;case 1:return++f,{done:!1,value:D(O.readFile,O,[__dirname+"/../src/egs-prelude.gs","utf8"])};case 2:i=b,++f;case 3:return++f,{done:!1,value:Q()};case 4:return g=b,++f,{done:!1,value:g.parse(i)};case 5:return h=b,++f,{done:!0,value:h.macros};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+f)}}function d(a){throw b(),a}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g,h,i;return f=0,{close:b,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}})),c={},[function(a){var d;return null==a&&(a=null),d=b(),a?y.call(c,a)?c[a]:c[a]=u(function(){function b(){g=5}function c(b){for(;;)switch(g){case 0:return++g,{done:!1,value:d};case 1:return h=b,++g,{done:!1,value:D(O.readFile,O,[a,"utf8"])};case 2:return k=b,++g,{done:!1,value:Q()};case 3:return i=b,++g,{done:!1,value:i.parse(k,{macros:h})};case 4:return j=b,++g,{done:!0,value:j.macros};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw b(),a}function f(a){try{return c(a)}catch(b){e(b)}}var f,g,c,e,h,i,j,k;return g=0,{close:b,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}()):d},function(b){return a=b,this}]}(),R=F[0],bb=F[1],P=function(){var a;return a=f(z(function(){function a(){e=2}function b(a){for(;;)switch(e){case 0:return++e,{done:!1,value:Q()};case 1:return m=a,g=m.AST,o=function(a,b){var c;return a instanceof g.Call?(c=a.func,c instanceof g.Ident&&c.name===b):void 0},p=function(a,b){var c,d,e;return a instanceof g.Call&&(c=a.func,c instanceof g.Binary&&"."===c.op)?(d=c.left,e=c.right,d instanceof g.Ident&&"context"===d.name&&e.isConst()&&e.constValue()===b):!1},l=function(a){return o(a,"write")&&2===a.args.length&&a.args[1].isConst()&&a.args[1].constValue()?g.Call(a.pos,a.func,[g.Call(a.pos,g.Access(a.pos,g.Ident(a.pos,"context"),g.Const(a.pos,"escape")),[a.args[0]])]):void 0},v=function(a){var b;return p(a,"escape")&&1===a.args.length&&(b=a.args[0],b&&(p(b,"h")||p(b,"html"))&&1===b.args.length)?b.args[0]:void 0},h=function(a){var b;return a.isConst()?"string"!=typeof a.constValue():a instanceof g.Binary?"+"===a.op?h(a.left)&&h(a.right):!0:a instanceof g.IfExpression?h(a.whenTrue)||h(a.whenFalse):a instanceof g.BlockExpression||a instanceof g.BlockStatement?h((b=a.body)[b.length-1]):!p(a,"escape")},q=function(a){var b,c,d,e,f,i,j,k,l,m,n;if(a instanceof g.BlockExpression||a instanceof g.BlockStatement){for(d=a.body.slice(),e=!1,b=C(d),f=0,c=b.length;c>f;++f)l=b[f],j=l.walkWithThis(q),d[f]=j,j!==l&&(e=!0);for(f=0;f<d.length-1;)i=d[f],k=d[f+1],o(i,"write")&&1===i.args.length&&o(k,"write")&&1===k.args.length?(e=!0,d.splice(f,2,g.Call(i.pos,i.func,[g.Binary(i.pos,h(i.args[0])&&h(k.args[0])?g.Binary(i.pos,g.Const(i.pos,""),"+",i.args[0]):i.args[0],"+",k.args[0])]))):++f;if(e)return g.Block(a.pos,d,a.label)}else if((a instanceof g.IfStatement||a instanceof g.IfExpression)&&!a.label&&(n=a.whenTrue.walkWithThis(q),m=a.whenFalse.walkWithThis(q),o(n,"write")&&(o(m,"write")||m.isNoop())))return g.Call(a.pos,n.func,[g.IfExpression(a.pos,a.test.walkWithThis(q),n.args[0],m.isNoop()?g.Const(m.pos,""):m.args[0])])},n=function(a){var b;b={};try{a.walk(function(a){if(a instanceof g.Func)return a;if(p(a,"extends"))throw b})}catch(c){if(c===b)return!0;throw c}return!1},u=function(a){return a instanceof g.Func?a:o(a,"write")?g.Noop(a.pos):void 0},t=function(a){return a instanceof g.Func&&n(a)?a.walk(u):void 0},k=function(a){return o(a,"write")?g.Binary(a.pos,a.func,"+=",a.args[0]).walkWithThis(k):void 0},r=function(a,b){return b instanceof g.Binary&&"+"===b.op?g.Binary(a.pos,r(a,b.left),"+",b.right):g.Binary(a.pos,a,"+",b)},j=function(a){var b,c,d;return a instanceof g.BlockStatement&&(d=(b=a.body)[b.length-1],d instanceof g.Return&&d.node instanceof g.Ident&&"write"===d.node.name&&(c=(b=a.body)[b.length-2],c&&c instanceof g.Binary&&"+="===c.op&&c.left instanceof g.Ident&&"write"===c.left.name))?g.BlockStatement(a.pos,C(B.call(a.body,0,-2)).concat([g.Return(c.pos,r(c.left,c.right))]),a.label):void 0},s=function(a){return a instanceof g.Binary&&"=="===a.op&&a.left instanceof g.Ident&&"context"===a.left.name&&a.right.isConst()&&null==a.right.constValue()?g.Const(a.pos,!1):void 0},i=function(a){return function(b){return b instanceof g.Binary&&"."===b.op&&b.left instanceof g.Ident&&"context"===b.left.name&&b.right.isConst()&&w(b.right.constValue(),a)?g.Binary(b.pos,g.Ident(b.left.pos,"helpers"),".",b.right):void 0}},f=function(a){return a instanceof g.Func&&2===a.params.length&&"write"===a.params[0].name&&"context"===a.params[1].name?g.Func(a.pos,a.name,[a.params[0],a.params[1],g.Ident(a.pos,"helpers")],a.variables,a.body,a.declarations):void 0},++e,{done:!0,value:function(a){return function(b){return b.walk(l).walk(v).walk(q).walk(t).walk(k).walk(j).walk(s).walk(i(a)).walk(f)}}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+e)}}function c(b){throw a(),b}function d(a){try{return b(a)}catch(d){c(d)}}var d,e,b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return e=0,{close:a,iterator:function(){return this},next:function(){return d(void 0)},send:d,"throw":function(a){return c(a),d(void 0)}}})),z(function(b){function c(){g=2}function d(c){for(;;)switch(g){case 0:return++g,{done:!1,value:a()};case 1:return h=c,++g,{done:!0,value:h(b)};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}})}(),I=z(function(a,b,c){function d(){j=9}function e(d){for(;;)switch(j){case 0:return++j,{done:!1,value:R(b.prelude)};case 1:return p=d,++j,{done:!1,value:P(c)};case 2:return l=d,i=v({},b),i.embedded=!0,i.noindent=!0,i.macros=p,i.prelude=null,i.astPipe=l,q=i,o=!1,++j,{done:!1,value:Q()};case 3:n=d,++j;case 4:return++j,{done:!1,value:n.compile(a,q)};case 5:k=d,m=k.code,j=8;break;case 6:return q.embeddedGenerator=!0,o=!0,++j,{done:!1,value:n.compile(a,q)};case 7:k=d,m=k.code,++j;case 8:return++j,{done:!0,value:{isGenerator:o,code:m}};case 9:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){if(4!==j&&5!==j)throw d(),a;h=a,j=6}function g(a){for(;;)try{return e(a)}catch(b){f(b)}}var h,i,g,j,e,f,k,l,m,n,o,p,q;return j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),H=z(function(a,b,c){function d(){i=2}function e(d){for(;;)switch(i){case 0:return++i,{done:!1,value:I(a,b,c)};case 1:return h=d,k=h.isGenerator,j=h.code,++i,{done:!0,value:{func:k?z(Function("return "+j)()):Function("return "+j)(),isSimple:function(){var a,b,c,d,e;for(b=!0,a=["extends","partial","block"],c=0,d=a.length;d>c;++c)if(e=a[c],-1!==j.indexOf("helpers."+e)||-1!==j.indexOf('helpers["'+e+'"]')){b=!1;break}return b}()}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var h,g,i,e,f,j,k;return i=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),J=function(){var a;return a={},function(b,c,d){var e,f;return f=y.call(a,b)?a[b]:a[b]={},y.call(f,e=h(c)+"\0"+d.join("\0"))?f[e]:f[e]=function(){var a,e,f,g;return f=z(function(){function a(){h=3}function e(a){for(;;)switch(h){case 0:return++h,{done:!1,value:D(O.readFile,O,[b,"utf8"])};case 1:return i=a,++h,{done:!1,value:H(i,c,d)};case 2:return++h,{done:!0,value:a};case 3:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(b){throw a(),b}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:a,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),c.cache?i(f()):(g=z(function(){function a(){f=2}function c(a){for(;;)switch(f){case 0:return++f,{done:!1,value:D(O.stat,O,[b])};case 1:return g=a,++f,{done:!0,value:g.mtime.getTime()};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+f)}}function d(b){throw a(),b}function e(a){try{return c(a)}catch(b){d(b)}}var e,f,c,d,g;return f=0,{close:a,iterator:function(){return this},next:function(){return e(void 0)},send:e,"throw":function(a){return d(a),e(void 0)}}}),a=f(),e=g(),z(function(){function b(){i=4}function c(b){for(;;)switch(i){case 0:return k=g(),++i,{done:!1,value:e};case 1:return j=b,++i,{done:!1,value:k};case 2:return j=j!==b,j&&(a=f(),e=k),++i,{done:!1,value:a};case 3:return++i,{done:!0,value:b};case 4:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function d(a){throw b(),a}function h(a){try{return c(a)}catch(b){d(b)}}var h,i,c,d,j,k;return i=0,{close:b,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return d(a),h(void 0)}}}))}()}}(),N=z(function(a,b,c,d){function e(){i=2}function f(e){for(;;)switch(i){case 0:return null==c&&(c={}),k=S(a,b),++i,{done:!1,value:J(k,c,d)()};case 1:return j=e,++i,{done:!0,value:{filepath:k,compiled:j}};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+i)}}function g(a){throw e(),a}function h(a){try{return f(a)}catch(b){g(b)}}var h,i,f,g,j,k;return i=0,{close:e,iterator:function(){return this},next:function(){return h(void 0)},send:h,"throw":function(a){return g(a),h(void 0)}}}),_=v({},T),F=v({},T),F["extends"]=function(a,b){if(!this.__currentFilepath$)throw L("Can only use extends if the 'filename' option is specified");if(this.__inPartial$)throw L("Cannot use extends when in a partial");if(this.__extendedBy$)throw L("Cannot use extends more than once");this.__extendedBy$=this.__fetchCompiled$(a),this.__extendedByLocals$=b},F.partial=k(z(function(a,b,c){function d(){j=5}function e(d){for(;;)switch(j){case 0:if(null==c&&(c={}),!k.__currentFilepath$)throw L("Can only use partial if the 'filename' option is specified");return a=X.join(X.dirname(a),""+k.__partialPrefix$+X.basename(a)),++j,{done:!1,value:k.__fetchCompiled$(a)};case 1:i=d,l=i.filepath,m=i.compiled.func,h=r(k),h.__currentFilepath$=l,h.__inPartial$=!0,n=h,j=m.maybeSync?2:4;break;case 2:return++j,{done:!1,value:m.maybeSync(b,c,n)};case 3:return j=5,{done:!0,value:d};case 4:return++j,{done:!0,value:m(b,c,n)};case 5:return{done:!0,value:void 0};default:throw Error("Unknown state: "+j)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var h,i,g,j,e,k,f,l,m,n;return k=this,j=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}})),F.block=k(z(function(a,b,c){function d(){h=6}function e(d){for(;;)switch(h){case 0:if(null==c&&(c=null),i.__inPartial$)throw L("Cannot use block when in a partial");k=i.__blocks$,m=i.__helpers$,h=i.__extendedBy$&&!m.__inBlock$?1:2;break;case 1:return null==c||y.call(k,a)||(k[a]=c),h=6,{done:!0,value:b};case 2:j=y.call(k,a)&&k[a]||c,l=b,h=j?3:5;break;case 3:return m.__inBlock$=!0,++h,{done:!1,value:z(j(b),!0)};case 4:l=d,m.__inBlock$=!1,++h;case 5:return++h,{done:!0,value:l};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,i,f,j,k,l,m;return i=this,h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}})),F.__handleExtends$=k(z(function(){function a(){g=9}function b(a){for(;;)switch(g){case 0:return++g,{done:!1,value:h.__extendedBy$};case 1:f=a,i=f.filepath,j=f.compiled.func,e=r(h),e.__currentFilepath$=i,e.__extendedBy$=null,e.__extendedByLocals$=null,l=e,k=h.__extendedByLocals$||{},g=j.maybeSync?2:4;break;case 2:return++g,{done:!1,value:j.maybeSync("",k,l)};case 3:m=a,g=5;break;case 4:m=j("",k,l),++g;case 5:g=l.__extendedBy$?6:8;break;case 6:return++g,{done:!1,value:l.__handleExtends$(l,m)};case 7:return g=9,{done:!0,value:a};case 8:return++g,{done:!0,value:m};case 9:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function c(b){throw a(),b}function d(a){try{return b(a)}catch(d){c(d)}}var e,f,d,g,b,h,c,i,j,k,l,m;return h=this,g=0,{close:a,iterator:function(){return this},next:function(){return d(void 0)},send:d,"throw":function(a){return c(a),d(void 0)}}})),U=F,V=function(){function a(a,b,c,d,e){var f,g;return f=r(U),f.__currentFilepath$=b,f.__partialPrefix$=a,f.__fetchCompiled$=c,f.__extendedBy$=null,f.__extendedByLocals$=null,f.__inPartial$=!1,f.__inBlock$=!1,f.escape=d,g=r(_),g.__currentFilepath$=b,g.escape=d,e&&(v(g,e),v(f,e)),function(a){var b;return a?g:(b=r(f),b.__helpers$=b,b.__blocks$={},b)}}return function(b,c){return a("string"==typeof b.partialPrefix?b.partialPrefix:"_",b.filename,function(){var a,d;return d=b.__inPackage$,d?function(a){return d._find(a,this.__currentFilepath$)}:(a=j(b),function(b){return N(b,this.__currentFilepath$,a,c)})}(),"function"==typeof b.escape?b.escape:ab.escapeHTML,y.call(b,"context")?b.context:b)}}(),Y=z(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),i=o(a,m(b)),c||(c=y.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),Z=z(function(a,b,c){function d(){h=2}function e(d){for(;;)switch(h){case 0:return null==b&&(b={context:null}),b.filename=a,i=p(a,m(b)),c||(c=y.call(b,"context")?b.context:b),++h,{done:!1,value:i.maybeSync(c)};case 1:return++h,{done:!0,value:d};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),M=z(function(a,b){function c(){g=3}function d(c){for(;;)switch(g){case 0:return++g,{done:!1,value:D(O.readdir,O,[a])};case 1:return h=c,i=[],++g,{done:!1,value:A(3,+h.length,z(function(c){function d(){k=6}function e(d){for(;;)switch(k){case 0:return m=h[c],l=X.join(a,m),++k,{done:!1,value:D(O.stat,O,[l])};case 1:n=d,k=n.isDirectory()?2:4;break;case 2:return j=[],++k,{done:!1,value:M(l,b)};case 3:return j.push.apply(j,C(d)),k=6,{done:!0,value:i.push.apply(i,j)};case 4:k=n.isFile()&&X.extname(m)===b?5:6;break;case 5:return++k,{done:!0,value:i.push(l)};case 6:return{done:!0,value:void 0};default:throw Error("Unknown state: "+k)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var j,g,k,e,f,l,m,n;return k=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}))};case 2:return++g,{done:!0,value:i.sort()};case 3:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,e,h,i;return g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),K=z(function(a,b,c){function d(){h=7}function e(d){for(;;)switch(h){case 0:return null==c&&(c={}),++h,{done:!1,value:D(O.stat,O,[a])};case 1:if(j=d,!j.isDirectory())throw Error("Expected '"+a+"' to be a directory.");return++h,{done:!1,value:M(a,".egs")};case 2:return m=d,++h,{done:!1,value:Q()};case 3:return l=d,++h,{done:!1,value:R(c.prelude)};case 4:return o=d,++h,{done:!1,value:P(n({}))};case 5:return i=d,k=function(b,d,e){function f(a){var b;return a instanceof e.Call&&(a.func instanceof e.Func||a.func instanceof e.Binary&&"."===a.func.op&&a.func.left instanceof e.Func&&a.func.right.isConst()&&("call"===(b=a.func.right.constValue())||"apply"===b))}function g(b){return b.pos.file&&!y.call(h,b.pos.file)&&f(b)?(h[b.pos.file]=!0,e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"templates"),e.Const(b.pos,"set")),[e.Const(b.pos,X.relative(a,b.pos.file)),b])):void 0}var h;return h={},b=i(b).walk(g),e.Root(b.pos,e.Call(b.pos,e.Access(b.pos,e.Func(b.pos,null,[e.Ident(b.pos,"factory")],[],e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"module")),"!==",e.Const(b.pos,"undefined")),e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports"))),e.Assign(b.pos,e.Access(b.pos,e.Ident(b.pos,"module"),e.Const(b.pos,"exports")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Call(b.pos,e.Ident(b.pos,"require"),[e.Const(b.pos,"egs")])])),e.IfStatement(b.pos,e.And(b.pos,e.Binary(b.pos,e.Unary(b.pos,"typeof",e.Ident(b.pos,"define")),"===",e.Const(b.pos,"function")),e.Access(b.pos,e.Ident(b.pos,"define"),e.Const(b.pos,"amd"))),e.Call(b.pos,e.Ident(b.pos,"define"),[e.Arr(b.pos,[e.Const(b.pos,"egs")]),e.Ident(b.pos,"factory")]),e.Assign(b.pos,e.Access(b.pos,e.This(b.pos),e.Const(b.pos,c.globalExport||"EGSTemplates")),e.Call(b.pos,e.Ident(b.pos,"factory"),[e.Access(b.pos,e.This(b.pos),e.Const(b.pos,"EGS"))]))))),e.Const(b.pos,"call")),[e.This(b.pos),e.Func(b.pos,null,[e.Ident(b.pos,"EGS")],["templates"],e.Block(b.pos,[e.IfStatement(b.pos,e.Unary(b.pos,"!",e.Ident(b.pos,"EGS")),e.Throw(b.pos,e.Call(b.pos,e.Ident(b.pos,"Error"),[e.Const(b.pos,"Expected EGS to be available")]))),e.Assign(b.pos,e.Ident(b.pos,"templates"),e.Call(b.pos,e.Access(b.pos,e.Ident(b.pos,"EGS"),e.Const(b.pos,"Package")),[])),b.body,e.Return(b.pos,e.Ident(b.pos,"templates"))]))]),[],[])},++h,{done:!1,value:l.compileFile({input:m,output:b,embedded:!0,embeddedGenerator:!0,noindent:!0,embeddedOpen:c.open,embeddedOpenWrite:c.openWrite,embeddedOpenComment:c.openComment,embeddedClose:c.close,embeddedCloseWrite:c.closeWrite,embeddedCloseComment:c.closeComment,coverage:c.coverage,sourceMap:c.sourceMap,macros:o,astPipe:k})};case 6:return++h,{done:!0,value:d};case 7:return{done:!0,value:void 0};default:throw Error("Unknown state: "+h)}}function f(a){throw d(),a}function g(a){try{return e(a)}catch(b){f(b)}}var g,h,e,f,i,j,k,l,m,o;return h=0,{close:d,iterator:function(){return this},next:function(){return g(void 0)},send:g,"throw":function(a){return f(a),g(void 0)}}}),W=function(){function a(b){var d;return d=this instanceof a?this:r(c),null==b&&(b={}),d.options=b,d.factories={},d.templates={},d}function b(a){return 47!==a.charCodeAt(0)?"/"+a:a}var c;return c=a.prototype,a.displayName="Package",c.set=function(a,c,d){var e;return null==d&&(d={}),a=b(a),e=this.factories[a]=z(c),this.templates[a]=l(i(s.fulfilled({func:e,isSimple:!1})),V(v(v({__inPackage$:this,filename:a},this.options),d)),!0),this},c.get=function(a){var c;if(a=b(a),c=this.templates,y.call(c,a))return c[a];throw L("Unknown filepath: '"+a+"'")},c.render=z(function(a,b){function c(){g=2}function d(c){for(;;)switch(g){case 0:return null==b&&(b={}),i=h.get(a),++g,{done:!1,value:i(b)};case 1:return++g,{done:!0,value:c};case 2:return{done:!0,value:void 0};default:throw Error("Unknown state: "+g)}}function e(a){throw c(),a}function f(a){try{return d(a)}catch(b){e(b)}}var f,g,d,h,e,i;return h=this,g=0,{close:c,iterator:function(){return this},next:function(){return f(void 0)},send:f,"throw":function(a){return e(a),f(void 0)}}}),c.renderSync=function(a,b){var c;return null==b&&(b={}),c=this.get(a),c.sync(b)},c._find=function(a,b){var c,d;return d=S(a,b),c=this.factories,y.call(c,d)?s.fulfilled({filepath:d,compiled:{func:c[d],isSimple:!1}}):s.rejected(L("Cannot find '"+a+"' from '"+d+"', tried '"+d+"'"))},c.express=function(){var a;return a=this,function(b,c,d){t(a.render(b,c))(d)}},a}(),o.version="0.1.4",o.fromFile=p,o.render=Y,o.renderFile=Z,o.withEgsPrelude=bb,o.compilePackage=K,o.Package=W,o.EgsError=L,o.compile=function(a,b,c){return null==a&&(a=""),null==b&&(b={}),null==c&&(c=[]),I(a,j(b),c)},o.__express=q,o.express=function(a){return null==a&&(a={}),function(b,c,d){null==c&&(c={}),q(b,v(v({},a),c),d)}},d.exports=o}.call(this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),d.exports},c["./helpers"]=function(){var a={exports:this},b=this;return function(){var a,c;a="function"==typeof Object.create?Object.create:function(a){function b(){}return b.prototype=a,new b},c=function(){function b(d){var e;return e=this instanceof b?this:a(c),e.text=d,e}var c;return c=b.prototype,b.displayName="RawHTML",c.toHTML=function(){return this.text},b}(),b.h=b.html=function(a){return c(String(a))},b.j=b.javascript=function(){function a(a){return b[a]}var b,d;return b={"\\":"\\\\","\r":"\\r","\u2028":"\\u2028","\u2029":"\\u2029","\n":"\\n","\f":"\\f","'":"\\'",'"':'\\"',"	":"\\t"},d=/[\\\r\u2028\u2029\n\f'"\t]/g,function(b){return c(String(b).replace(d,a))}}()}.call(this),a.exports},c["./utils"]=function(){var a={exports:this},b=this;return function(){var a;a=function(){var a;return a=Object.prototype.toString,function(b){return void 0===b?"Undefined":null===b?"Null":b.constructor&&b.constructor.name||a.call(b).slice(8,-1)}}(),b.escapeHTML=function(){function b(a){return d[a]}function c(a){return a.replace(e,b)}var d,e;return d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},e=/[&<>"']/g,function(b){if("string"==typeof b)return c(b);if("number"==typeof b)return b.toString();if(null!=b&&"function"==typeof b.toHTML)return String(b.toHTML());throw TypeError("Expected a String, Number, or Object with a toHTML method, got "+a(b))}}()}.call(this),a.exports},c("./egs").withEgsPrelude("macro extends(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE context.extends $name, $new-context\n\nmacro block\n  syntax ident as Identifier, body as GeneratorBody?\n    let name = @const @name(ident)\n    if body?\n      ASTE! write := yield context.block $name, write, #(write)*\n        $body\n        write\n    else\n      ASTE! write := yield context.block $name, write\n\nmacro partial(name, locals)\n  let new-context = if locals and not locals.is-const()\n    ASTE {} <<< context <<< $locals\n  else\n    ASTE context\n  ASTE! write := yield context.partial $name, write, $new-context\n")};"function"==typeof define&&define.amd?define(function(a){return b(a)}):"undefined"!=typeof module&&"function"==typeof require?module.exports=b(require):a.EGS=b()}(this);